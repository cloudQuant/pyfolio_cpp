<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pyfolio C++: Pyfolio C++ æ”¹è¿›å¾…åŠäº‹é¡¹æ¸…å•</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Pyfolio C++<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">High-performance C++20 financial portfolio analysis library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d1/dcd/md__2Users_2yunjinqi_2Documents_2source__code_2pyfolio__cpp_2docs_2IMPROVEMENT__TODO__LIST.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Pyfolio C++ æ”¹è¿›å¾…åŠäº‹é¡¹æ¸…å•</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md68"></a></p>
<h1><a class="anchor" id="autotoc_md69"></a>
å‰è¨€</h1>
<p>åŸºäºå¯¹åŸå§‹ pyfolio Python åº“å’Œ pyfolio_cpp C++ é‡æ„ç‰ˆæœ¬çš„æ·±åº¦åˆ†æï¼Œæœ¬æ–‡æ¡£è¯¦ç»†åˆ—å‡ºäº†éœ€è¦æ”¹è¿›çš„å…³é”®é¢†åŸŸã€‚ä½œä¸ºæ‹¥æœ‰30å¹´ç»éªŒçš„ C++ å’Œ Python é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆçš„åˆ†æç»“æœï¼Œè¿™äº›æ”¹è¿›å»ºè®®å°†æ˜¾è‘—æå‡é¡¹ç›®çš„ä»£ç è´¨é‡ã€æ€§èƒ½å’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚</p>
<hr  />
<h1><a class="anchor" id="autotoc_md71"></a>
ğŸ”´ <b>ä¼˜å…ˆçº§ 1 - ç´§æ€¥ä¿®å¤ (Critical - ç«‹å³å¤„ç†)</b></h1>
<h2><a class="anchor" id="autotoc_md72"></a>
1.1 API å…¼å®¹æ€§ä¿®å¤</h2>
<p><b>å½±å“èŒƒå›´</b>: 75% çš„æµ‹è¯•å¤±è´¥ <b>é¢„è®¡å·¥ä½œé‡</b>: 3-5 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md73"></a>
é—®é¢˜è¯¦è¿°:</h3>
<ul>
<li><b>æ–‡ä»¶</b>: <code>tests/test_python_pos_equivalence.cpp:19-27</code><ul>
<li>Position æ„é€ å‡½æ•°ç­¾åä¸åŒ¹é…</li>
<li>éœ€è¦æ›´æ–°æ„é€ å‡½æ•°å‚æ•°é¡ºåºå’Œç±»å‹</li>
</ul>
</li>
<li><b>æ–‡ä»¶</b>: <code>tests/test_positions.cpp</code><ul>
<li>12 ä¸ª TODO æ³¨é‡Š (è¡Œ 85, 92, 100 ç­‰)</li>
<li>AllocationAnalyzer API ä¸å…¼å®¹</li>
<li>æ–¹æ³•åç§°å’Œå‚æ•°ä¸åŒ¹é…</li>
</ul>
</li>
<li><b>æ–‡ä»¶</b>: <code>tests/test_regime_detection.cpp:62, 76-77</code><ul>
<li>MarketIndicators å®ç°ç¼ºå¤±</li>
<li>éœ€è¦å®ç°å®Œæ•´çš„å¸‚åœºæŒ‡æ ‡åˆ†æåŠŸèƒ½</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md74"></a>
è§£å†³æ–¹æ¡ˆ:</h3>
<div class="fragment"><div class="line"><span class="comment">// ç¤ºä¾‹ä¿®å¤ - Position æ„é€ å‡½æ•°</span></div>
<div class="line"><span class="keyword">class </span>Position {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// å½“å‰: Position(symbol, quantity, price)</span></div>
<div class="line">    <span class="comment">// éœ€è¦: Position(symbol, market_value, quantity, price)</span></div>
<div class="line">    Position(<span class="keyword">const</span> Symbol&amp; symbol, </div>
<div class="line">             <span class="keyword">const</span> MarketValue&amp; market_value,</div>
<div class="line">             <span class="keyword">const</span> Quantity&amp; quantity, </div>
<div class="line">             <span class="keyword">const</span> Price&amp; price);</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md75"></a>
1.2 ç¼ºå¤±å®ç°è¡¥å…¨</h2>
<p><b>å½±å“èŒƒå›´</b>: æ ¸å¿ƒåŠŸèƒ½ä¸å®Œæ•´ <b>é¢„è®¡å·¥ä½œé‡</b>: 5-7 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md76"></a>
Regime Detection æ¨¡å—ç¼ºå¤±:</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–‡ä»¶: include/pyfolio/analytics/regime_detection.h</span></div>
<div class="line"><span class="comment">// éœ€è¦å®ç°çš„æ–¹æ³•:</span></div>
<div class="line"><span class="keyword">class </span>RegimeDetector {</div>
<div class="line">    Result&lt;RegimeAnalysis&gt; markov_switching_detection(<span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns);</div>
<div class="line">    Result&lt;RegimeAnalysis&gt; hidden_markov_detection(<span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns);</div>
<div class="line">    Result&lt;RegimeAnalysis&gt; structural_break_detection(<span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns);</div>
<div class="line">    Result&lt;RegimeAnalysis&gt; volatility_regime_detection(<span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns);</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md77"></a>
MarketIndicators å®ç°:</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–°æ–‡ä»¶: include/pyfolio/analytics/market_indicators.h</span></div>
<div class="line"><span class="keyword">class </span>MarketIndicators {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Result&lt;TimeSeries&lt;double&gt;&gt; calculate_vix_regime(<span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns);</div>
<div class="line">    Result&lt;TimeSeries&lt;double&gt;&gt; calculate_yield_curve_slope(<span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns);</div>
<div class="line">    Result&lt;TimeSeries&lt;double&gt;&gt; calculate_credit_spreads(<span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns);</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md78"></a>
1.3 é”™è¯¯å¤„ç†ä¸€è‡´æ€§</h2>
<p><b>é—®é¢˜</b>: æ··åˆä½¿ç”¨å¼‚å¸¸å’Œ Result&lt;T&gt; æ¨¡å¼ <b>é¢„è®¡å·¥ä½œé‡</b>: 2-3 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md79"></a>
å½“å‰é—®é¢˜:</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–‡ä»¶: include/pyfolio/core/time_series.h:29</span></div>
<div class="line"><span class="keywordtype">void</span> validate_consistency()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (timestamps_.size() != values_.size()) {</div>
<div class="line">        <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;TimeSeries: timestamps and values size mismatch&quot;</span>); <span class="comment">// âŒ ä¸ä¸€è‡´</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md80"></a>
ä¿®å¤æ–¹æ¡ˆ:</h3>
<div class="fragment"><div class="line">Result&lt;void&gt; validate_consistency()<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (timestamps_.size() != values_.size()) {</div>
<div class="line">        <span class="keywordflow">return</span> Error{ErrorCode::SIZE_MISMATCH, <span class="stringliteral">&quot;TimeSeries: timestamps and values size mismatch&quot;</span>};</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="../../d7/df8/namespacepyfolio.html#a10901a85b628face8a96ad7e052555f9a505a83f220c02df2f85c3810cd9ceb38">Success</a>{};</div>
<div class="line">}</div>
<div class="ttc" id="anamespacepyfolio_html_a10901a85b628face8a96ad7e052555f9a505a83f220c02df2f85c3810cd9ceb38"><div class="ttname"><a href="../../d7/df8/namespacepyfolio.html#a10901a85b628face8a96ad7e052555f9a505a83f220c02df2f85c3810cd9ceb38">pyfolio::ErrorCode::Success</a></div><div class="ttdeci">@ Success</div><div class="ttdef"><b>Definition</b> <a href="../../d3/d11/error__handling_8h_source.html#l00016">error_handling.h:16</a></div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md82"></a>
ğŸŸ¡ <b>ä¼˜å…ˆçº§ 2 - æ€§èƒ½ä¼˜åŒ– (Performance - çŸ­æœŸå¤„ç†)</b></h1>
<h2><a class="anchor" id="autotoc_md83"></a>
2.1 ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–</h2>
<p><b>å½±å“èŒƒå›´</b>: æ ¸å¿ƒè®¡ç®—æ€§èƒ½ <b>é¢„è®¡å·¥ä½œé‡</b>: 4-6 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md84"></a>
A. TimeSeries æ’åºæ€§èƒ½é—®é¢˜</h3>
<p><b>æ–‡ä»¶</b>: <code><a class="el" href="../../d8/d51/time__series_8h.html">include/pyfolio/core/time_series.h</a>:126-148</code> <b>é—®é¢˜</b>: O(n) é¢å¤–å†…å­˜åˆ†é…</p>
<div class="fragment"><div class="line"><span class="comment">// å½“å‰å®ç° - ä½æ•ˆ</span></div>
<div class="line"><span class="keywordtype">void</span> sort_by_time() {</div>
<div class="line">    std::vector&lt;DateTime&gt; sorted_timestamps;    <span class="comment">// âŒ é¢å¤–å†…å­˜åˆ†é…</span></div>
<div class="line">    std::vector&lt;T&gt; sorted_values;              <span class="comment">// âŒ é¢å¤–å†…å­˜åˆ†é…</span></div>
<div class="line">    <span class="comment">// ... æ‹·è´æ•´ä¸ªå‘é‡</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ä¼˜åŒ–æ–¹æ¡ˆ - åŸåœ°æ’åº</span></div>
<div class="line"><span class="keywordtype">void</span> sort_by_time() {</div>
<div class="line">    std::vector&lt;size_t&gt; indices(timestamps_.size());</div>
<div class="line">    std::iota(indices.begin(), indices.end(), 0);</div>
<div class="line">    </div>
<div class="line">    std::sort(indices.begin(), indices.end(), </div>
<div class="line">        [<span class="keyword">this</span>](<span class="keywordtype">size_t</span> i, <span class="keywordtype">size_t</span> j) { return timestamps_[i] &lt; timestamps_[j]; });</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// ä½¿ç”¨ indices è¿›è¡ŒåŸåœ°é‡æ’åº</span></div>
<div class="line">    apply_permutation(timestamps_, indices);</div>
<div class="line">    apply_permutation(values_, indices);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md85"></a>
B. æ»šåŠ¨æŒ‡æ ‡ç®—æ³•æ•ˆç‡</h3>
<p><b>æ–‡ä»¶</b>: <code><a class="el" href="../../d3/d7e/rolling__metrics_8h.html">include/pyfolio/performance/rolling_metrics.h</a>:40-68</code> <b>é—®é¢˜</b>: O(nÂ²) å¤æ‚åº¦</p>
<div class="fragment"><div class="line"><span class="comment">// å½“å‰å®ç° - O(nÂ²)</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; values.size(); ++i) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = start_idx; j &lt;= i; ++j) {     <span class="comment">// âŒ é‡å¤è®¡ç®—</span></div>
<div class="line">        sum += values[j];</div>
<div class="line">        sum_sq += values[j] * values[j];</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ä¼˜åŒ–æ–¹æ¡ˆ - O(n) æ»‘åŠ¨çª—å£</span></div>
<div class="line"><span class="keyword">class </span>RollingWindow {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    std::deque&lt;double&gt; window_;</div>
<div class="line">    <span class="keywordtype">double</span> sum_ = 0.0;</div>
<div class="line">    <span class="keywordtype">double</span> sum_sq_ = 0.0;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> add_value(<span class="keywordtype">double</span> value) {</div>
<div class="line">        <span class="keywordflow">if</span> (window_.size() &gt;= window_size_) {</div>
<div class="line">            <span class="keywordtype">double</span> old_value = window_.front();</div>
<div class="line">            window_.pop_front();</div>
<div class="line">            sum_ -= old_value;</div>
<div class="line">            sum_sq_ -= old_value * old_value;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        window_.push_back(value);</div>
<div class="line">        sum_ += value;</div>
<div class="line">        sum_sq_ += value * value;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">double</span> <a class="code hl_function" href="../../d1/d32/namespacepyfolio_1_1analytics_1_1cached.html#af806e5aece2fa569d3cec8ba37a4b31a">mean</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> sum_ / window_.size(); }</div>
<div class="line">    <span class="keywordtype">double</span> <a class="code hl_function" href="../../d6/ddc/namespacepyfolio_1_1stats.html#afae76bfc655b39b929869957f17e2406">variance</a>()<span class="keyword"> const </span>{ </div>
<div class="line">        <span class="keywordtype">double</span> mean_val = <a class="code hl_function" href="../../d1/d32/namespacepyfolio_1_1analytics_1_1cached.html#af806e5aece2fa569d3cec8ba37a4b31a">mean</a>();</div>
<div class="line">        <span class="keywordflow">return</span> (sum_sq_ / window_.size()) - (mean_val * mean_val);</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="anamespacepyfolio_1_1analytics_1_1cached_html_af806e5aece2fa569d3cec8ba37a4b31a"><div class="ttname"><a href="../../d1/d32/namespacepyfolio_1_1analytics_1_1cached.html#af806e5aece2fa569d3cec8ba37a4b31a">pyfolio::analytics::cached::mean</a></div><div class="ttdeci">Result&lt; double &gt; mean(const TimeSeries&lt; T &gt; &amp;series)</div><div class="ttdef"><b>Definition</b> <a href="../../d4/dc1/cached__performance__metrics_8h_source.html#l00533">cached_performance_metrics.h:533</a></div></div>
<div class="ttc" id="anamespacepyfolio_1_1stats_html_afae76bfc655b39b929869957f17e2406"><div class="ttname"><a href="../../d6/ddc/namespacepyfolio_1_1stats.html#afae76bfc655b39b929869957f17e2406">pyfolio::stats::variance</a></div><div class="ttdeci">Result&lt; double &gt; variance(std::span&lt; const T &gt; data, bool sample=true)</div><div class="ttdoc">Calculate variance of a data series.</div><div class="ttdef"><b>Definition</b> <a href="../../d3/dbe/math_2statistics_8h_source.html#l00125">statistics.h:125</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md86"></a>
2.2 å†…å­˜ä½¿ç”¨ä¼˜åŒ–</h2>
<p><b>é¢„è®¡å·¥ä½œé‡</b>: 2-3 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md87"></a>
SIMD ä¼˜åŒ–æœºä¼š:</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–‡ä»¶: include/pyfolio/math/statistics.h</span></div>
<div class="line"><span class="comment">// å½“å‰å®ç°</span></div>
<div class="line"><span class="keywordtype">double</span> calculate_mean(<span class="keyword">const</span> std::vector&lt;double&gt;&amp; values) {</div>
<div class="line">    <span class="keywordflow">return</span> std::accumulate(values.begin(), values.end(), 0.0) / values.size();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// SIMD ä¼˜åŒ–ç‰ˆæœ¬</span></div>
<div class="line"><span class="preprocessor">#include &lt;immintrin.h&gt;</span></div>
<div class="line"><span class="keywordtype">double</span> calculate_mean_simd(<span class="keyword">const</span> std::vector&lt;double&gt;&amp; values) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> simd_size = 4; <span class="comment">// AVX2 å¯ä»¥å¤„ç† 4 ä¸ª double</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> aligned_size = (values.size() / simd_size) * simd_size;</div>
<div class="line">    </div>
<div class="line">    __m256d sum_vec = _mm256_setzero_pd();</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; aligned_size; i += simd_size) {</div>
<div class="line">        __m256d data = _mm256_loadu_pd(&amp;values[i]);</div>
<div class="line">        sum_vec = _mm256_add_pd(sum_vec, data);</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// æå–å¹¶æ±‚å’Œ SIMD ç»“æœ</span></div>
<div class="line">    <span class="keywordtype">double</span> sum_array[4];</div>
<div class="line">    _mm256_storeu_pd(sum_array, sum_vec);</div>
<div class="line">    <span class="keywordtype">double</span> total = sum_array[0] + sum_array[1] + sum_array[2] + sum_array[3];</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// å¤„ç†å‰©ä½™å…ƒç´ </span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = aligned_size; i &lt; values.size(); ++i) {</div>
<div class="line">        total += values[i];</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> total / values.size();</div>
<div class="line">}</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md89"></a>
ğŸŸ  <b>ä¼˜å…ˆçº§ 3 - ç°ä»£ C++ ç‰¹æ€§ (Modern C++ - ä¸­æœŸå¤„ç†)</b></h1>
<h2><a class="anchor" id="autotoc_md90"></a>
3.1 ç¼–è¯‘æ—¶ä¼˜åŒ–</h2>
<p><b>é¢„è®¡å·¥ä½œé‡</b>: 3-4 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md91"></a>
A. æ‰©å±• <code>constexpr</code> ä½¿ç”¨</h3>
<div class="fragment"><div class="line"><span class="comment">// å½“å‰ - è¿è¡Œæ—¶è®¡ç®—</span></div>
<div class="line"><span class="keywordtype">double</span> sharpe_ratio(<span class="keywordtype">double</span> annual_return, <span class="keywordtype">double</span> annual_volatility, <span class="keywordtype">double</span> risk_free_rate = 0.0) {</div>
<div class="line">    <span class="keywordflow">return</span> (annual_return - risk_free_rate) / annual_volatility;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ä¼˜åŒ– - ç¼–è¯‘æ—¶è®¡ç®—</span></div>
<div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">double</span> sharpe_ratio(<span class="keywordtype">double</span> annual_return, <span class="keywordtype">double</span> annual_volatility, <span class="keywordtype">double</span> risk_free_rate = 0.0) {</div>
<div class="line">    <span class="keywordflow">return</span> (annual_return - risk_free_rate) / annual_volatility;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ç¼–è¯‘æ—¶å¸¸é‡è®¡ç®—</span></div>
<div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">double</span> <a class="code hl_variable" href="../../db/d9c/namespacepyfolio_1_1constants.html#accf4b9e8a1c9179437b61a3f9a0e2e53">TRADING_DAYS_PER_YEAR</a> = 252.0;</div>
<div class="line"><span class="keyword">constexpr</span> <span class="keywordtype">double</span> SQRT_TRADING_DAYS = std::sqrt(TRADING_DAYS_PER_YEAR); <span class="comment">// C++26</span></div>
<div class="ttc" id="anamespacepyfolio_1_1constants_html_accf4b9e8a1c9179437b61a3f9a0e2e53"><div class="ttname"><a href="../../db/d9c/namespacepyfolio_1_1constants.html#accf4b9e8a1c9179437b61a3f9a0e2e53">pyfolio::constants::TRADING_DAYS_PER_YEAR</a></div><div class="ttdeci">constexpr double TRADING_DAYS_PER_YEAR</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d49/types_8h_source.html#l00059">types.h:59</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md92"></a>
B. æ·»åŠ  <code>[[nodiscard]]</code> å±æ€§</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–‡ä»¶: include/pyfolio/core/error_handling.h</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>[[nodiscard]] Result {  <span class="comment">// âœ… é˜²æ­¢æ„å¤–å¿½ç•¥ç»“æœ</span></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    [[nodiscard]] <span class="keywordtype">bool</span> is_success() const noexcept;</div>
<div class="line">    [[nodiscard]] <span class="keywordtype">bool</span> is_error() const noexcept;</div>
<div class="line">    [[nodiscard]] const T&amp; value() const&amp;;</div>
<div class="line">    [[nodiscard]] T&amp;&amp; value() &amp;&amp;;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// æ€§èƒ½å…³é”®å‡½æ•°</span></div>
<div class="line">[[nodiscard]] Result&lt;<span class="keywordtype">double</span>&gt; calculate_volatility(const TimeSeries&lt;<span class="keywordtype">double</span>&gt;&amp; returns);</div>
<div class="line">[[nodiscard]] Result&lt;<span class="keywordtype">double</span>&gt; calculate_max_drawdown(const TimeSeries&lt;<span class="keywordtype">double</span>&gt;&amp; returns);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md93"></a>
3.2 ç±»å‹å®‰å…¨å¢å¼º</h2>
<p><b>é¢„è®¡å·¥ä½œé‡</b>: 2-3 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md94"></a>
std::span è§†å›¾ä¼˜åŒ–</h3>
<div class="fragment"><div class="line"><span class="comment">// å½“å‰ - åˆ›å»ºä¸´æ—¶å¯¹è±¡</span></div>
<div class="line">TimeSeries&lt;double&gt; get_window(<span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end)<span class="keyword"> const </span>{</div>
<div class="line">    std::vector&lt;DateTime&gt; window_timestamps(timestamps_.begin() + start, timestamps_.begin() + end);</div>
<div class="line">    std::vector&lt;double&gt; window_values(values_.begin() + start, values_.begin() + end);</div>
<div class="line">    <span class="keywordflow">return</span> TimeSeries&lt;double&gt;(std::move(window_timestamps), std::move(window_values));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ä¼˜åŒ– - é›¶æ‹·è´è§†å›¾</span></div>
<div class="line">std::pair&lt;std::span&lt;const DateTime&gt;, std::span&lt;const double&gt;&gt; </div>
<div class="line">get_window_view(<span class="keywordtype">size_t</span> start, <span class="keywordtype">size_t</span> end)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keywordflow">return</span> {</div>
<div class="line">        std::span&lt;const DateTime&gt;{timestamps_.data() + start, end - start},</div>
<div class="line">        std::span&lt;const double&gt;{values_.data() + start, end - start}</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md95"></a>
å¼ºåŒ– Concepts</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–‡ä»¶: include/pyfolio/core/types.h</span></div>
<div class="line"><span class="comment">// å½“å‰æ¦‚å¿µå®šä¹‰</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">concept </span>Numeric = std::is_arithmetic_v&lt;T&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// å¢å¼ºçš„æ¦‚å¿µå®šä¹‰</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">concept </span>FinancialValue = <span class="keyword">requires</span>(T t) {</div>
<div class="line">    { t.value() } -&gt; std::convertible_to&lt;double&gt;;</div>
<div class="line">    { T::zero() } -&gt; std::same_as&lt;T&gt;;</div>
<div class="line">    { t + t } -&gt; std::same_as&lt;T&gt;;</div>
<div class="line">    { t - t } -&gt; std::same_as&lt;T&gt;;</div>
<div class="line">    { t * 2.0 } -&gt; std::same_as&lt;T&gt;;</div>
<div class="line">    { t / 2.0 } -&gt; std::same_as&lt;T&gt;;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">concept </span>TimeSeriesValue = FinancialValue&lt;T&gt; &amp;&amp; <span class="keyword">requires</span> {</div>
<div class="line">    <span class="keyword">typename</span> T::value_type;</div>
<div class="line">    std::is_default_constructible_v&lt;T&gt;;</div>
<div class="line">    std::is_copy_constructible_v&lt;T&gt;;</div>
<div class="line">    std::is_move_constructible_v&lt;T&gt;;</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md97"></a>
ğŸ”µ <b>ä¼˜å…ˆçº§ 4 - åŠŸèƒ½å¢å¼º (Features - ä¸­é•¿æœŸå¤„ç†)</b></h1>
<h2><a class="anchor" id="autotoc_md98"></a>
4.1 ç¼ºå¤±çš„ Python åŠŸèƒ½</h2>
<p><b>é¢„è®¡å·¥ä½œé‡</b>: 8-12 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md99"></a>
A. Web æ¡†æ¶é›†æˆ (æ›¿ä»£ Flask)</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–°æ–‡ä»¶: include/pyfolio/web/server.h</span></div>
<div class="line"><span class="preprocessor">#include &lt;crow.h&gt;</span>  <span class="comment">// è½»é‡çº§ C++ web æ¡†æ¶</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>PyfolioWebServer {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    crow::SimpleApp app_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> setup_routes() {</div>
<div class="line">        <span class="comment">// ä¸»é¡µè·¯ç”±</span></div>
<div class="line">        CROW_ROUTE(app_, <span class="stringliteral">&quot;/&quot;</span>)([](){</div>
<div class="line">            <span class="keywordflow">return</span> crow::load_text(<span class="stringliteral">&quot;templates/index.html&quot;</span>);</div>
<div class="line">        });</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// API è·¯ç”±</span></div>
<div class="line">        CROW_ROUTE(app_, <span class="stringliteral">&quot;/api/analysis&quot;</span>)</div>
<div class="line">        .methods(<span class="stringliteral">&quot;POST&quot;</span>_method)</div>
<div class="line">        ([<span class="keyword">this</span>](<span class="keyword">const</span> crow::request&amp; req) {</div>
<div class="line">            <span class="keywordflow">return</span> generate_analysis_json(req.body);</div>
<div class="line">        });</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// é™æ€æ–‡ä»¶æœåŠ¡</span></div>
<div class="line">        CROW_ROUTE(app_, <span class="stringliteral">&quot;/static/&lt;path&gt;&quot;</span>)</div>
<div class="line">        ([](<span class="keyword">const</span> std::string&amp; path) {</div>
<div class="line">            <span class="keywordflow">return</span> crow::load_text(<span class="stringliteral">&quot;static/&quot;</span> + path);</div>
<div class="line">        });</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> start(<span class="keywordtype">int</span> port = 8080) {</div>
<div class="line">        app_.port(port).multithreaded().run();</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    crow::response generate_analysis_json(<span class="keyword">const</span> std::string&amp; request_data);</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md100"></a>
B. å¢å¼ºçš„å¯è§†åŒ–åŠŸèƒ½</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–‡ä»¶: include/pyfolio/visualization/plotly_integration.h</span></div>
<div class="line"><span class="preprocessor">#include &lt;nlohmann/json.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>PlotlyChart {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">static</span> nlohmann::json create_returns_chart(<span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns) {</div>
<div class="line">        nlohmann::json chart;</div>
<div class="line">        chart[<span class="stringliteral">&quot;data&quot;</span>] = nlohmann::json::array();</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">auto</span>&amp; trace = chart[<span class="stringliteral">&quot;data&quot;</span>][0];</div>
<div class="line">        trace[<span class="stringliteral">&quot;type&quot;</span>] = <span class="stringliteral">&quot;scatter&quot;</span>;</div>
<div class="line">        trace[<span class="stringliteral">&quot;mode&quot;</span>] = <span class="stringliteral">&quot;lines&quot;</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// è½¬æ¢æ—¶é—´åºåˆ—æ•°æ®</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [timestamp, value] : returns) {</div>
<div class="line">            trace[<span class="stringliteral">&quot;x&quot;</span>].push_back(timestamp.to_iso_string());</div>
<div class="line">            trace[<span class="stringliteral">&quot;y&quot;</span>].push_back(value);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        chart[<span class="stringliteral">&quot;layout&quot;</span>][<span class="stringliteral">&quot;title&quot;</span>] = <span class="stringliteral">&quot;Portfolio Returns&quot;</span>;</div>
<div class="line">        chart[<span class="stringliteral">&quot;layout&quot;</span>][<span class="stringliteral">&quot;xaxis&quot;</span>][<span class="stringliteral">&quot;title&quot;</span>] = <span class="stringliteral">&quot;Date&quot;</span>;</div>
<div class="line">        chart[<span class="stringliteral">&quot;layout&quot;</span>][<span class="stringliteral">&quot;yaxis&quot;</span>][<span class="stringliteral">&quot;title&quot;</span>] = <span class="stringliteral">&quot;Returns&quot;</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> chart;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">static</span> std::string to_html(<span class="keyword">const</span> nlohmann::json&amp; chart) {</div>
<div class="line">        std::string html = R<span class="stringliteral">&quot;(</span></div>
<div class="line"><span class="stringliteral">&lt;!DOCTYPE html&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;html&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;head&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;script src=&quot;https://cdn.plot.ly/plotly-latest.min.js&quot;&gt;&lt;/script&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;/head&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;body&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;div id=&quot;chart&quot;&gt;&lt;/div&gt;</span></div>
<div class="line"><span class="stringliteral">    &lt;script&gt;</span></div>
<div class="line"><span class="stringliteral">        Plotly.newPlot(&#39;chart&#39;, )&quot; + chart.dump() + R</span><span class="stringliteral">&quot;();</span></div>
<div class="line"><span class="stringliteral">    &lt;/script&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;/body&gt;</span></div>
<div class="line"><span class="stringliteral">&lt;/html&gt;)&quot;;</span></div>
<div class="line"><span class="stringliteral">        </span><span class="keywordflow">return</span> html;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md101"></a>
4.2 é«˜çº§åˆ†æåŠŸèƒ½</h2>
<p><b>é¢„è®¡å·¥ä½œé‡</b>: 6-8 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md102"></a>
A. æœºå™¨å­¦ä¹ é›†æˆ</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–°æ–‡ä»¶: include/pyfolio/ml/regime_ml.h</span></div>
<div class="line"><span class="preprocessor">#include &lt;dlib/svm.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MLRegimeDetector {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">using </span>sample_type = dlib::matrix&lt;double, 0, 1&gt;;</div>
<div class="line">    <span class="keyword">using </span>kernel_type = dlib::radial_basis_kernel&lt;sample_type&gt;;</div>
<div class="line">    dlib::svm_c_trainer&lt;kernel_type&gt; trainer_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Result&lt;RegimeClassification&gt; detect_regimes_ml(</div>
<div class="line">        <span class="keyword">const</span> TimeSeries&lt;double&gt;&amp; returns,</div>
<div class="line">        <span class="keyword">const</span> std::vector&lt;FeatureVector&gt;&amp; features) {</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// ç‰¹å¾å·¥ç¨‹</span></div>
<div class="line">        std::vector&lt;sample_type&gt; samples;</div>
<div class="line">        std::vector&lt;double&gt; labels;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; feature : features) {</div>
<div class="line">            sample_type sample;</div>
<div class="line">            sample.set_size(feature.size());</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; feature.size(); ++i) {</div>
<div class="line">                sample(i) = feature[i];</div>
<div class="line">            }</div>
<div class="line">            samples.push_back(sample);</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// è®­ç»ƒ SVM æ¨¡å‹</span></div>
<div class="line">        <span class="keyword">auto</span> decision_function = trainer_.train(samples, labels);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// åº”ç”¨æ¨¡å‹è¿›è¡Œåˆ†ç±»</span></div>
<div class="line">        RegimeClassification result;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; sample : samples) {</div>
<div class="line">            result.regimes.push_back(decision_function(sample));</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="../../d7/df8/namespacepyfolio.html#a10901a85b628face8a96ad7e052555f9a505a83f220c02df2f85c3810cd9ceb38">Success</a>{result};</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md103"></a>
B. å®æ—¶åˆ†ææ”¯æŒ</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–°æ–‡ä»¶: include/pyfolio/realtime/streaming.h</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">class </span>StreamingAnalyzer {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    RollingWindow&lt;T&gt; window_;</div>
<div class="line">    std::vector&lt;std::function&lt;void(<span class="keyword">const</span> AnalysisResult&amp;)&gt;&gt; callbacks_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keywordtype">void</span> add_data_point(<span class="keyword">const</span> DateTime&amp; timestamp, <span class="keyword">const</span> T&amp; value) {</div>
<div class="line">        window_.add(timestamp, value);</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (window_.size() &gt;= min_window_size_) {</div>
<div class="line">            <span class="keyword">auto</span> analysis = perform_analysis();</div>
<div class="line">            notify_callbacks(analysis);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> subscribe(std::function&lt;<span class="keywordtype">void</span>(<span class="keyword">const</span> AnalysisResult&amp;)&gt; callback) {</div>
<div class="line">        callbacks_.push_back(std::move(callback));</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    AnalysisResult perform_analysis() {</div>
<div class="line">        AnalysisResult result;</div>
<div class="line">        result.sharpe_ratio = calculate_sharpe_ratio(window_.returns());</div>
<div class="line">        result.max_drawdown = calculate_max_drawdown(window_.returns());</div>
<div class="line">        result.volatility = <a class="code hl_function" href="../../d8/dd9/namespacepyfolio_1_1performance.html#a187ff948556631bd1ebbe0c3c87bdb76">calculate_volatility</a>(window_.returns());</div>
<div class="line">        <span class="keywordflow">return</span> result;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> notify_callbacks(<span class="keyword">const</span> AnalysisResult&amp; result) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; callback : callbacks_) {</div>
<div class="line">            callback(result);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="anamespacepyfolio_1_1performance_html_a187ff948556631bd1ebbe0c3c87bdb76"><div class="ttname"><a href="../../d8/dd9/namespacepyfolio_1_1performance.html#a187ff948556631bd1ebbe0c3c87bdb76">pyfolio::performance::calculate_volatility</a></div><div class="ttdeci">Result&lt; double &gt; calculate_volatility(const ReturnSeries &amp;returns, Frequency frequency=Frequency::Daily)</div><div class="ttdoc">Calculate return volatility (annualized standard deviation)</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d73/returns_8h_source.html#l00202">returns.h:202</a></div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md105"></a>
ğŸŸ¢ <b>ä¼˜å…ˆçº§ 5 - è´¨é‡æå‡ (Quality - é•¿æœŸå¤„ç†)</b></h1>
<h2><a class="anchor" id="autotoc_md106"></a>
5.1 æµ‹è¯•è¦†ç›–ç‡æå‡</h2>
<p><b>ç›®æ ‡</b>: ä» 60-70% æå‡åˆ° 95%+ <b>é¢„è®¡å·¥ä½œé‡</b>: 5-7 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md107"></a>
A. è¾¹ç•Œæ¡ä»¶æµ‹è¯•</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–‡ä»¶: tests/test_edge_cases.cpp</span></div>
<div class="line">TEST(PerformanceMetrics, EmptyTimeSeries) {</div>
<div class="line">    TimeSeries&lt;double&gt; empty_series;</div>
<div class="line">    <span class="keyword">auto</span> result = calculate_sharpe_ratio(empty_series);</div>
<div class="line">    EXPECT_TRUE(result.is_error());</div>
<div class="line">    EXPECT_EQ(result.error().code, ErrorCode::INSUFFICIENT_DATA);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(PerformanceMetrics, SingleDataPoint) {</div>
<div class="line">    TimeSeries&lt;double&gt; single_point;</div>
<div class="line">    single_point.add(DateTime::now(), 0.05);</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> result = calculate_volatility(single_point);</div>
<div class="line">    EXPECT_TRUE(result.is_error());</div>
<div class="line">    EXPECT_EQ(result.error().code, ErrorCode::INSUFFICIENT_DATA);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TEST(PerformanceMetrics, NaNHandling) {</div>
<div class="line">    TimeSeries&lt;double&gt; series_with_nan;</div>
<div class="line">    series_with_nan.add(DateTime::now(), 0.05);</div>
<div class="line">    series_with_nan.add(DateTime::now() + std::chrono::days(1), std::numeric_limits&lt;double&gt;::quiet_NaN());</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> result = calculate_mean(series_with_nan);</div>
<div class="line">    EXPECT_TRUE(result.is_error());</div>
<div class="line">    EXPECT_EQ(result.error().code, ErrorCode::INVALID_DATA);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md108"></a>
B. æ€§èƒ½å›å½’æµ‹è¯•</h3>
<div class="fragment"><div class="line"><span class="comment">// æ–‡ä»¶: tests/test_performance_regression.cpp</span></div>
<div class="line"><span class="keyword">class </span>PerformanceBenchmark : <span class="keyword">public</span> ::testing::Test {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    TimeSeries&lt;double&gt; large_series_;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> SetUp()<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// ç”Ÿæˆ 100,000 ä¸ªæ•°æ®ç‚¹</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 100000; ++i) {</div>
<div class="line">            large_series_.add(</div>
<div class="line">                DateTime::from_days_since_epoch(i),</div>
<div class="line">                random_normal_distribution_(generator_)</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">TEST_F(PerformanceBenchmark, SharpeRatioPerformance) {</div>
<div class="line">    <span class="keyword">auto</span> start = std::chrono::high_resolution_clock::now();</div>
<div class="line">    <span class="keyword">auto</span> result = calculate_sharpe_ratio(large_series_);</div>
<div class="line">    <span class="keyword">auto</span> end = std::chrono::high_resolution_clock::now();</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">auto</span> duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end - start);</div>
<div class="line">    </div>
<div class="line">    EXPECT_TRUE(result.is_success());</div>
<div class="line">    EXPECT_LT(duration.count(), 100); <span class="comment">// åº”è¯¥åœ¨ 100ms å†…å®Œæˆ</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md109"></a>
5.2 ä»£ç è´¨é‡å·¥å…·é›†æˆ</h2>
<p><b>é¢„è®¡å·¥ä½œé‡</b>: 2-3 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md110"></a>
A. é™æ€ä»£ç åˆ†æ</h3>
<div class="fragment"><div class="line"># CMakeLists.txt å¢å¼º</div>
<div class="line">find_program(CLANG_TIDY_EXE NAMES &quot;clang-tidy&quot;)</div>
<div class="line">if(CLANG_TIDY_EXE)</div>
<div class="line">    set(CMAKE_CXX_CLANG_TIDY </div>
<div class="line">        ${CLANG_TIDY_EXE};</div>
<div class="line">        -checks=*,-fuchsia-*,-google-*,-zircon-*,-abseil-*,-llvm-header-guard;</div>
<div class="line">        -header-filter=.*pyfolio.*</div>
<div class="line">    )</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">find_program(CPPCHECK_EXE NAMES &quot;cppcheck&quot;)</div>
<div class="line">if(CPPCHECK_EXE)</div>
<div class="line">    add_custom_target(</div>
<div class="line">        cppcheck</div>
<div class="line">        COMMAND ${CPPCHECK_EXE}</div>
<div class="line">        --enable=warning,performance,portability</div>
<div class="line">        --std=c++20</div>
<div class="line">        --template=&quot;[{severity}][{id}] {message} {callstack} \&zwj;(On {file}:{line}\&zwj;)&quot;</div>
<div class="line">        --verbose</div>
<div class="line">        --quiet</div>
<div class="line">        ${CMAKE_SOURCE_DIR}/include</div>
<div class="line">    )</div>
<div class="line">endif()</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md111"></a>
B. ä»£ç æ ¼å¼åŒ–æ ‡å‡†åŒ–</h3>
<div class="fragment"><div class="line"># .clang-format</div>
<div class="line">---</div>
<div class="line">Language: Cpp</div>
<div class="line">BasedOnStyle: Google</div>
<div class="line">IndentWidth: 4</div>
<div class="line">TabWidth: 4</div>
<div class="line">UseTab: Never</div>
<div class="line">ColumnLimit: 100</div>
<div class="line">AlignAfterOpenBracket: Align</div>
<div class="line">AlignConsecutiveAssignments: true</div>
<div class="line">AlignConsecutiveDeclarations: true</div>
<div class="line">AllowShortFunctionsOnASingleLine: Empty</div>
<div class="line">AllowShortIfStatementsOnASingleLine: false</div>
<div class="line">AlwaysBreakTemplateDeclarations: true</div>
<div class="line">BreakBeforeBraces: Attach</div>
<div class="line">BreakConstructorInitializers: BeforeColon</div>
<div class="line">IncludeBlocks: Regroup</div>
<div class="line">NamespaceIndentation: None</div>
<div class="line">PointerAlignment: Left</div>
<div class="line">SpaceAfterCStyleCast: false</div>
<div class="line">SpaceAfterTemplateKeyword: true</div>
<div class="line">SpaceBeforeAssignmentOperators: true</div>
<div class="line">SpaceBeforeCpp11BracedList: false</div>
<div class="line">SpaceBeforeParens: ControlStatements</div>
<div class="line">SpaceInEmptyParentheses: false</div>
<div class="line">Standard: c++20</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md112"></a>
5.3 æ–‡æ¡£å®Œå–„</h2>
<p><b>é¢„è®¡å·¥ä½œé‡</b>: 4-5 å·¥ä½œæ—¥</p>
<h3><a class="anchor" id="autotoc_md113"></a>
A. API æ–‡æ¡£ç”Ÿæˆ</h3>
<div class="fragment"><div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span>&lt;Numeric T&gt;</div>
<div class="line"><span class="keyword">class </span>PerformanceCalculator {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    [[nodiscard]] Result&lt;T&gt; sharpe_ratio(</div>
<div class="line">        <span class="keyword">const</span> TimeSeries&lt;T&gt;&amp; returns,</div>
<div class="line">        T risk_free_rate = T{0.0},</div>
<div class="line">        <span class="keywordtype">size_t</span> periods_per_year = 252</div>
<div class="line">    ) <span class="keyword">const</span> <span class="keyword">noexcept</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md115"></a>
ğŸ“Š <b>å®æ–½ä¼˜å…ˆçº§çŸ©é˜µ</b></h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ç±»åˆ«   </th><th class="markdownTableHeadNone">å·¥ä½œé‡   </th><th class="markdownTableHeadNone">ä¸šåŠ¡å½±å“   </th><th class="markdownTableHeadNone">æŠ€æœ¯å½±å“   </th><th class="markdownTableHeadNone">æ¨èé¡ºåº    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">API å…¼å®¹æ€§ä¿®å¤   </td><td class="markdownTableBodyNone">3-5å¤©   </td><td class="markdownTableBodyNone">ğŸ”´ é«˜   </td><td class="markdownTableBodyNone">ğŸ”´ é«˜   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ç¼ºå¤±å®ç°è¡¥å…¨   </td><td class="markdownTableBodyNone">5-7å¤©   </td><td class="markdownTableBodyNone">ğŸ”´ é«˜   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">é”™è¯¯å¤„ç†ä¸€è‡´æ€§   </td><td class="markdownTableBodyNone">2-3å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">ğŸ”´ é«˜   </td><td class="markdownTableBodyNone">3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–   </td><td class="markdownTableBodyNone">4-6å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">ğŸ”´ é«˜   </td><td class="markdownTableBodyNone">4    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">å†…å­˜ä½¿ç”¨ä¼˜åŒ–   </td><td class="markdownTableBodyNone">2-3å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ç°ä»£ C++ ç‰¹æ€§   </td><td class="markdownTableBodyNone">3-4å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¢ ä½   </td><td class="markdownTableBodyNone">ğŸ”´ é«˜   </td><td class="markdownTableBodyNone">6    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ç±»å‹å®‰å…¨å¢å¼º   </td><td class="markdownTableBodyNone">2-3å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¢ ä½   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">7    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Web æ¡†æ¶é›†æˆ   </td><td class="markdownTableBodyNone">8-12å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">ğŸŸ¢ ä½   </td><td class="markdownTableBodyNone">8    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">é«˜çº§åˆ†æåŠŸèƒ½   </td><td class="markdownTableBodyNone">6-8å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">ğŸŸ¢ ä½   </td><td class="markdownTableBodyNone">9    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">æµ‹è¯•è¦†ç›–ç‡æå‡   </td><td class="markdownTableBodyNone">5-7å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">10    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ä»£ç è´¨é‡å·¥å…·   </td><td class="markdownTableBodyNone">2-3å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¢ ä½   </td><td class="markdownTableBodyNone">ğŸŸ¡ ä¸­   </td><td class="markdownTableBodyNone">11    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">æ–‡æ¡£å®Œå–„   </td><td class="markdownTableBodyNone">4-5å¤©   </td><td class="markdownTableBodyNone">ğŸŸ¢ ä½   </td><td class="markdownTableBodyNone">ğŸŸ¢ ä½   </td><td class="markdownTableBodyNone">12   </td></tr>
</table>
<p><b>æ€»é¢„è®¡å·¥ä½œé‡</b>: 47-66 å·¥ä½œæ—¥ (çº¦ 2-3 ä¸ªæœˆ)</p>
<hr  />
<h1><a class="anchor" id="autotoc_md117"></a>
ğŸ¯ <b>é˜¶æ®µæ€§ç›®æ ‡</b></h1>
<h2><a class="anchor" id="autotoc_md118"></a>
ç¬¬ä¸€é˜¶æ®µ (ç¬¬ 1-2 å‘¨): åŸºç¡€ä¿®å¤</h2>
<ul>
<li>âœ… ä¿®å¤æ‰€æœ‰ API å…¼å®¹æ€§é—®é¢˜</li>
<li>âœ… è¡¥å…¨ MarketIndicators å’Œ RegimeDetection å®ç°</li>
<li>âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å¼</li>
<li><b>ç›®æ ‡</b>: æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ° 80%</li>
</ul>
<h2><a class="anchor" id="autotoc_md119"></a>
ç¬¬äºŒé˜¶æ®µ (ç¬¬ 3-4 å‘¨): æ€§èƒ½ä¼˜åŒ–</h2>
<ul>
<li>âœ… å®æ–½ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–</li>
<li>âœ… å†…å­˜ä½¿ç”¨ä¼˜åŒ–</li>
<li>âœ… SIMD æŒ‡ä»¤é›†æˆ</li>
<li><b>ç›®æ ‡</b>: æ€§èƒ½æå‡ 2-5xï¼Œå†…å­˜ä½¿ç”¨å‡å°‘ 30%</li>
</ul>
<h2><a class="anchor" id="autotoc_md120"></a>
ç¬¬ä¸‰é˜¶æ®µ (ç¬¬ 5-8 å‘¨): åŠŸèƒ½å¢å¼º</h2>
<ul>
<li>âœ… ç°ä»£ C++ ç‰¹æ€§é›†æˆ</li>
<li>âœ… Web æ¡†æ¶å¼€å‘</li>
<li>âœ… é«˜çº§åˆ†æåŠŸèƒ½å®ç°</li>
<li><b>ç›®æ ‡</b>: åŠŸèƒ½è¦†ç›–ç‡è¾¾åˆ° 95ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡</li>
</ul>
<h2><a class="anchor" id="autotoc_md121"></a>
ç¬¬å››é˜¶æ®µ (ç¬¬ 9-12 å‘¨): è´¨é‡æå‡</h2>
<ul>
<li>âœ… æµ‹è¯•è¦†ç›–ç‡æå‡åˆ° 95%+</li>
<li>âœ… ä»£ç è´¨é‡å·¥å…·é›†æˆ</li>
<li>âœ… å®Œæ•´æ–‡æ¡£ç¼–å†™</li>
<li><b>ç›®æ ‡</b>: ç”Ÿäº§å°±ç»ªï¼Œå‘å¸ƒ v1.0</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md123"></a>
ğŸ”§ <b>å¼€å‘ç¯å¢ƒå»ºè®®</b></h1>
<h2><a class="anchor" id="autotoc_md124"></a>
æ„å»ºç³»ç»Ÿä¼˜åŒ–</h2>
<div class="fragment"><div class="line"># CMakeLists.txt å¢å¼ºç‰ˆæœ¬</div>
<div class="line">cmake_minimum_required(VERSION 3.20)</div>
<div class="line">project(pyfolio_cpp VERSION 1.0.0 LANGUAGES CXX)</div>
<div class="line"> </div>
<div class="line"># ç°ä»£ C++ æ ‡å‡†</div>
<div class="line">set(CMAKE_CXX_STANDARD 20)</div>
<div class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</div>
<div class="line">set(CMAKE_CXX_EXTENSIONS OFF)</div>
<div class="line"> </div>
<div class="line"># ç¼–è¯‘å™¨ä¼˜åŒ–é€‰é¡¹</div>
<div class="line">if(CMAKE_CXX_COMPILER_ID MATCHES &quot;GNU|Clang&quot;)</div>
<div class="line">    target_compile_options(pyfolio_cpp PRIVATE</div>
<div class="line">        -Wall -Wextra -Wpedantic</div>
<div class="line">        -march=native          # CPU æ¶æ„ä¼˜åŒ–</div>
<div class="line">        -O3                    # æœ€é«˜ä¼˜åŒ–çº§åˆ«</div>
<div class="line">        -DNDEBUG              # Release æ¨¡å¼</div>
<div class="line">        -flto                 # é“¾æ¥æ—¶ä¼˜åŒ–</div>
<div class="line">    )</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line"># åˆ†æå’Œè°ƒè¯•å·¥å…·</div>
<div class="line">option(ENABLE_SANITIZERS &quot;Enable address and undefined behavior sanitizers&quot; OFF)</div>
<div class="line">if(ENABLE_SANITIZERS)</div>
<div class="line">    target_compile_options(pyfolio_cpp PRIVATE -fsanitize=address,undefined)</div>
<div class="line">    target_link_options(pyfolio_cpp PRIVATE -fsanitize=address,undefined)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">option(ENABLE_PROFILING &quot;Enable profiling support&quot; OFF)</div>
<div class="line">if(ENABLE_PROFILING)</div>
<div class="line">    target_compile_options(pyfolio_cpp PRIVATE -pg)</div>
<div class="line">    target_link_options(pyfolio_cpp PRIVATE -pg)</div>
<div class="line">endif()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md125"></a>
æŒç»­é›†æˆé…ç½®</h2>
<div class="fragment"><div class="line"># .github/workflows/ci.yml</div>
<div class="line">name: CI</div>
<div class="line">on: [push, pull_request]</div>
<div class="line"> </div>
<div class="line">jobs:</div>
<div class="line">  test:</div>
<div class="line">    strategy:</div>
<div class="line">      matrix:</div>
<div class="line">        os: [ubuntu-latest, macos-latest, windows-latest]</div>
<div class="line">        compiler: [gcc-11, clang-14]</div>
<div class="line">        build_type: [Debug, Release]</div>
<div class="line">    </div>
<div class="line">    runs-on: ${{ matrix.os }}</div>
<div class="line">    </div>
<div class="line">    steps:</div>
<div class="line">    - uses: actions/checkout@v3</div>
<div class="line">    </div>
<div class="line">    - name: Install dependencies</div>
<div class="line">      run: |</div>
<div class="line">        sudo apt-get update</div>
<div class="line">        sudo apt-get install -y cmake ninja-build lcov</div>
<div class="line">    </div>
<div class="line">    - name: Configure</div>
<div class="line">      run: |</div>
<div class="line">        cmake -B build -G Ninja \</div>
<div class="line">          -DCMAKE_BUILD_TYPE=${{ matrix.build_type }} \</div>
<div class="line">          -DENABLE_TESTING=ON \</div>
<div class="line">          -DENABLE_COVERAGE=ON</div>
<div class="line">    </div>
<div class="line">    - name: Build</div>
<div class="line">      run: cmake --build build --parallel</div>
<div class="line">    </div>
<div class="line">    - name: Test</div>
<div class="line">      run: |</div>
<div class="line">        cd build</div>
<div class="line">        ctest --output-on-failure --parallel</div>
<div class="line">    </div>
<div class="line">    - name: Coverage</div>
<div class="line">      if: matrix.build_type == &#39;Debug&#39;</div>
<div class="line">      run: |</div>
<div class="line">        cd build</div>
<div class="line">        make coverage</div>
<div class="line">        bash &lt;(curl -s https://codecov.io/bash)</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md127"></a>
ğŸ“ˆ <b>é¢„æœŸæ”¶ç›Š</b></h1>
<h2><a class="anchor" id="autotoc_md128"></a>
æ€§èƒ½æå‡</h2>
<ul>
<li><b>è®¡ç®—æ€§èƒ½</b>: 10-100x æå‡ (å·²å®ç°éƒ¨åˆ†)</li>
<li><b>å†…å­˜æ•ˆç‡</b>: 50% å‡å°‘ (å·²å®ç°éƒ¨åˆ†) <br  />
</li>
<li><b>ç¼–è¯‘æ—¶ä¼˜åŒ–</b>: 20-30% æ„å»ºæ—¶é—´å‡å°‘</li>
<li><b>è¿è¡Œæ—¶å®‰å…¨</b>: 0 å´©æºƒç‡ (é€šè¿‡ Result&lt;T&gt; æ¨¡å¼)</li>
</ul>
<h2><a class="anchor" id="autotoc_md129"></a>
å¼€å‘æ•ˆç‡</h2>
<ul>
<li><b>API ä¸€è‡´æ€§</b>: 100% å…¼å®¹æ€§</li>
<li><b>ç±»å‹å®‰å…¨</b>: ç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹</li>
<li><b>æµ‹è¯•è¦†ç›–</b>: 95%+ ä»£ç è¦†ç›–ç‡</li>
<li><b>æ–‡æ¡£å®Œæ•´æ€§</b>: 100% API æ–‡æ¡£è¦†ç›–</li>
</ul>
<h2><a class="anchor" id="autotoc_md130"></a>
ç»´æŠ¤æ€§</h2>
<ul>
<li><b>ä»£ç è´¨é‡</b>: A+ ç­‰çº§ (é€šè¿‡é™æ€åˆ†æ)</li>
<li><b>æŠ€æœ¯å€ºåŠ¡</b>: æœ€å°åŒ–</li>
<li><b>æ‰©å±•æ€§</b>: æ”¯æŒæ–°åŠŸèƒ½å¿«é€Ÿå¼€å‘</li>
<li><b>ç¤¾åŒºè´¡çŒ®</b>: æ¸…æ™°çš„è´¡çŒ®æŒ‡å—</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md132"></a>
ğŸ’¡ <b>åˆ›æ–°ç‰¹æ€§å»ºè®®</b></h1>
<h2><a class="anchor" id="autotoc_md133"></a>
1. æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ</h2>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> KeyType, <span class="keyword">typename</span> ValueType&gt;</div>
<div class="line"><span class="keyword">class </span>IntelligentCache {</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keyword">mutable</span> std::shared_mutex cache_mutex_;</div>
<div class="line">    std::unordered_map&lt;KeyType, std::pair&lt;ValueType, std::chrono::steady_clock::time_point&gt;&gt; cache_;</div>
<div class="line">    std::chrono::seconds ttl_;</div>
<div class="line">    </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    std::optional&lt;ValueType&gt; get(<span class="keyword">const</span> KeyType&amp; key)<span class="keyword"> const </span>{</div>
<div class="line">        std::shared_lock lock(cache_mutex_);</div>
<div class="line">        <span class="keyword">auto</span> it = cache_.find(key);</div>
<div class="line">        <span class="keywordflow">if</span> (it != cache_.end()) {</div>
<div class="line">            <span class="keyword">auto</span> now = std::chrono::steady_clock::now();</div>
<div class="line">            <span class="keywordflow">if</span> (now - it-&gt;second.second &lt; ttl_) {</div>
<div class="line">                <span class="keywordflow">return</span> it-&gt;second.first;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">void</span> put(<span class="keyword">const</span> KeyType&amp; key, <span class="keyword">const</span> ValueType&amp; value) {</div>
<div class="line">        std::unique_lock lock(cache_mutex_);</div>
<div class="line">        cache_[key] = {value, std::chrono::steady_clock::now()};</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md134"></a>
2. è‡ªé€‚åº”å‚æ•°ä¼˜åŒ–</h2>
<div class="fragment"><div class="line"><span class="keyword">class </span>AdaptiveOptimizer {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Func, <span class="keyword">typename</span>... Args&gt;</div>
<div class="line">    <span class="keyword">auto</span> optimize_parameters(Func&amp;&amp; func, Args&amp;&amp;... args) {</div>
<div class="line">        <span class="comment">// ä½¿ç”¨æœºå™¨å­¦ä¹ ç®—æ³•è‡ªåŠ¨ä¼˜åŒ–å‚æ•°</span></div>
<div class="line">        <span class="comment">// åŸºäºå†å²æ€§èƒ½æ•°æ®è°ƒæ•´è®¡ç®—å‚æ•°</span></div>
<div class="line">        <span class="keywordflow">return</span> bayesian_optimization(std::forward&lt;Func&gt;(func), std::forward&lt;Args&gt;(args)...);</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md135"></a>
3. å¹¶è¡Œè®¡ç®—æ¡†æ¶</h2>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ExecutionPolicy = std::execution::par_unseq&gt;</div>
<div class="line"><span class="keyword">class </span>ParallelAnalyzer {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Container, <span class="keyword">typename</span> Func&gt;</div>
<div class="line">    <span class="keyword">auto</span> parallel_transform(<span class="keyword">const</span> Container&amp; input, Func&amp;&amp; func) {</div>
<div class="line">        std::vector&lt;std::invoke_result_t&lt;Func, typename Container::value_type&gt;&gt; output;</div>
<div class="line">        output.resize(input.size());</div>
<div class="line">        </div>
<div class="line">        std::transform(ExecutionPolicy{}, </div>
<div class="line">                      input.begin(), input.end(), </div>
<div class="line">                      output.begin(), </div>
<div class="line">                      std::forward&lt;Func&gt;(func));</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> output;</div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md137"></a>
ğŸ <b>ç»“è®º</b></h1>
<p>pyfolio_cpp é¡¹ç›®å±•ç°å‡ºä¼˜ç§€çš„æ¶æ„è®¾è®¡å’Œç°ä»£ C++ å®è·µï¼Œä½†ä»éœ€è¦ç³»ç»Ÿæ€§çš„æ”¹è¿›æ¥è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¦æ±‚ã€‚é€šè¿‡æŒ‰ç…§æœ¬æ–‡æ¡£çš„ä¼˜å…ˆçº§å’Œæ—¶é—´è®¡åˆ’æ‰§è¡Œæ”¹è¿›æªæ–½ï¼Œè¯¥é¡¹ç›®å°†æˆä¸ºä¸€ä¸ªé«˜æ€§èƒ½ã€ç±»å‹å®‰å…¨ã€åŠŸèƒ½å®Œæ•´çš„é‡‘èåˆ†æåº“ã€‚</p>
<p>å…³é”®æˆåŠŸå› ç´ :</p><ol type="1">
<li><b>ä¸¥æ ¼æŒ‰ç…§ä¼˜å…ˆçº§æ‰§è¡Œ</b>: å…ˆè§£å†³åŸºç¡€é—®é¢˜ï¼Œå†ä¼˜åŒ–æ€§èƒ½</li>
<li><b>æŒç»­é›†æˆ</b>: ç¡®ä¿æ¯ä¸ªæ”¹è¿›éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•</li>
<li><b>æ€§èƒ½åŸºå‡†</b>: æ¯ä¸ªä¼˜åŒ–éƒ½è¦æœ‰é‡åŒ–çš„æ€§èƒ½æå‡æŒ‡æ ‡</li>
<li><b>ä»£ç å®¡æŸ¥</b>: ç¡®ä¿ä»£ç è´¨é‡å’Œä¸€è‡´æ€§</li>
<li><b>æ–‡æ¡£åŒæ­¥</b>: ä»£ç å’Œæ–‡æ¡£åŒæ­¥æ›´æ–°</li>
</ol>
<p>é¢„è®¡å®Œæˆæ‰€æœ‰æ”¹è¿›åï¼Œpyfolio_cpp å°†æˆä¸ºä¸šç•Œé¢†å…ˆçš„ C++ é‡‘èåˆ†æåº“ï¼Œä¸ºç”¨æˆ·æä¾›å“è¶Šçš„æ€§èƒ½å’Œå¼€å‘ä½“éªŒã€‚</p>
<hr  />
<p><b>æ–‡æ¡£ç‰ˆæœ¬</b>: v1.0 <br  />
 <b>æœ€åæ›´æ–°</b>: 2024-06-28 <br  />
 <b>å®¡æŸ¥è€…</b>: 30å¹´ç»éªŒ C++/Python é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ <br  />
 <b>ä¸‹æ¬¡å®¡æŸ¥</b>: 2024-07-28 (æˆ–ä¸»è¦åŠŸèƒ½å®Œæˆå) </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun Jun 29 2025 12:06:36 for Pyfolio C++ by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
