<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.13.2" xml:lang="en-US">
  <compounddef id="db/db5/IMPROVEMENT__TODO__LIST_8md" kind="file" language="Markdown">
    <compoundname>IMPROVEMENT_TODO_LIST.md</compoundname>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline><highlight class="normal">#<sp/>Pyfolio<sp/>C++<sp/>æ”¹è¿›å¾…åŠäº‹é¡¹æ¸…å•</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>å‰è¨€</highlight></codeline>
<codeline><highlight class="normal">åŸºäºå¯¹åŸå§‹<sp/>pyfolio<sp/>Python<sp/>åº“å’Œ<sp/>pyfolio_cpp<sp/>C++<sp/>é‡æ„ç‰ˆæœ¬çš„æ·±åº¦åˆ†æï¼Œæœ¬æ–‡æ¡£è¯¦ç»†åˆ—å‡ºäº†éœ€è¦æ”¹è¿›çš„å…³é”®é¢†åŸŸã€‚ä½œä¸ºæ‹¥æœ‰30å¹´ç»éªŒçš„<sp/>C++<sp/>å’Œ<sp/>Python<sp/>é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆçš„åˆ†æç»“æœï¼Œè¿™äº›æ”¹è¿›å»ºè®®å°†æ˜¾è‘—æå‡é¡¹ç›®çš„ä»£ç è´¨é‡ã€æ€§èƒ½å’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸ”´<sp/>**ä¼˜å…ˆçº§<sp/>1<sp/>-<sp/>ç´§æ€¥ä¿®å¤<sp/>(Critical<sp/>-<sp/>ç«‹å³å¤„ç†)**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>1.1<sp/>API<sp/>å…¼å®¹æ€§ä¿®å¤</highlight></codeline>
<codeline><highlight class="normal">**å½±å“èŒƒå›´**:<sp/>75%<sp/>çš„æµ‹è¯•å¤±è´¥</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>3-5<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>é—®é¢˜è¯¦è¿°:</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**æ–‡ä»¶**:<sp/>`tests/test_python_pos_equivalence.cpp:19-27`</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-<sp/>Position<sp/>æ„é€ å‡½æ•°ç­¾åä¸åŒ¹é…</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-<sp/>éœ€è¦æ›´æ–°æ„é€ å‡½æ•°å‚æ•°é¡ºåºå’Œç±»å‹</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">-<sp/>**æ–‡ä»¶**:<sp/>`tests/test_positions.cpp`</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-<sp/>12<sp/>ä¸ª<sp/>TODO<sp/>æ³¨é‡Š<sp/>(è¡Œ<sp/>85,<sp/>92,<sp/>100<sp/>ç­‰)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-<sp/>AllocationAnalyzer<sp/>API<sp/>ä¸å…¼å®¹</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-<sp/>æ–¹æ³•åç§°å’Œå‚æ•°ä¸åŒ¹é…</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">-<sp/>**æ–‡ä»¶**:<sp/>`tests/test_regime_detection.cpp:62,<sp/>76-77`</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-<sp/>MarketIndicators<sp/>å®ç°ç¼ºå¤±</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>-<sp/>éœ€è¦å®ç°å®Œæ•´çš„å¸‚åœºæŒ‡æ ‡åˆ†æåŠŸèƒ½</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>è§£å†³æ–¹æ¡ˆ:</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>ç¤ºä¾‹ä¿®å¤<sp/>-<sp/>Position<sp/>æ„é€ å‡½æ•°</highlight></codeline>
<codeline><highlight class="normal">class<sp/>Position<sp/>{</highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>å½“å‰:<sp/>Position(symbol,<sp/>quantity,<sp/>price)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>éœ€è¦:<sp/>Position(symbol,<sp/>market_value,<sp/>quantity,<sp/>price)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Position(const<sp/>Symbol&amp;<sp/>symbol,<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>MarketValue&amp;<sp/>market_value,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>Quantity&amp;<sp/>quantity,<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>Price&amp;<sp/>price);</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>1.2<sp/>ç¼ºå¤±å®ç°è¡¥å…¨</highlight></codeline>
<codeline><highlight class="normal">**å½±å“èŒƒå›´**:<sp/>æ ¸å¿ƒåŠŸèƒ½ä¸å®Œæ•´</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>5-7<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>Regime<sp/>Detection<sp/>æ¨¡å—ç¼ºå¤±:</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–‡ä»¶:<sp/>include/pyfolio/analytics/regime_detection.h</highlight></codeline>
<codeline><highlight class="normal">//<sp/>éœ€è¦å®ç°çš„æ–¹æ³•:</highlight></codeline>
<codeline><highlight class="normal">class<sp/>RegimeDetector<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Result&lt;RegimeAnalysis&gt;<sp/>markov_switching_detection(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Result&lt;RegimeAnalysis&gt;<sp/>hidden_markov_detection(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Result&lt;RegimeAnalysis&gt;<sp/>structural_break_detection(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Result&lt;RegimeAnalysis&gt;<sp/>volatility_regime_detection(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>MarketIndicators<sp/>å®ç°:</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–°æ–‡ä»¶:<sp/>include/pyfolio/analytics/market_indicators.h</highlight></codeline>
<codeline><highlight class="normal">class<sp/>MarketIndicators<sp/>{</highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Result&lt;TimeSeries&lt;double&gt;&gt;<sp/>calculate_vix_regime(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Result&lt;TimeSeries&lt;double&gt;&gt;<sp/>calculate_yield_curve_slope(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Result&lt;TimeSeries&lt;double&gt;&gt;<sp/>calculate_credit_spreads(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>1.3<sp/>é”™è¯¯å¤„ç†ä¸€è‡´æ€§</highlight></codeline>
<codeline><highlight class="normal">**é—®é¢˜**:<sp/>æ··åˆä½¿ç”¨å¼‚å¸¸å’Œ<sp/>Result&lt;T&gt;<sp/>æ¨¡å¼</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>2-3<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>å½“å‰é—®é¢˜:</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–‡ä»¶:<sp/>include/pyfolio/core/time_series.h:29</highlight></codeline>
<codeline><highlight class="normal">void<sp/>validate_consistency()<sp/>const<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(timestamps_.size()<sp/>!=<sp/>values_.size())<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>throw<sp/>std::runtime_error(&quot;TimeSeries:<sp/>timestamps<sp/>and<sp/>values<sp/>size<sp/>mismatch&quot;);<sp/>//<sp/>âŒ<sp/>ä¸ä¸€è‡´</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>ä¿®å¤æ–¹æ¡ˆ:</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">Result&lt;void&gt;<sp/>validate_consistency()<sp/>const<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(timestamps_.size()<sp/>!=<sp/>values_.size())<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>Error{ErrorCode::SIZE_MISMATCH,<sp/>&quot;TimeSeries:<sp/>timestamps<sp/>and<sp/>values<sp/>size<sp/>mismatch&quot;};</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>Success{};</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸŸ¡<sp/>**ä¼˜å…ˆçº§<sp/>2<sp/>-<sp/>æ€§èƒ½ä¼˜åŒ–<sp/>(Performance<sp/>-<sp/>çŸ­æœŸå¤„ç†)**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>2.1<sp/>ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">**å½±å“èŒƒå›´**:<sp/>æ ¸å¿ƒè®¡ç®—æ€§èƒ½</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>4-6<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>A.<sp/>TimeSeries<sp/>æ’åºæ€§èƒ½é—®é¢˜</highlight></codeline>
<codeline><highlight class="normal">**æ–‡ä»¶**:<sp/>`include/pyfolio/core/time_series.h:126-148`</highlight></codeline>
<codeline><highlight class="normal">**é—®é¢˜**:<sp/>O(n)<sp/>é¢å¤–å†…å­˜åˆ†é…</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>å½“å‰å®ç°<sp/>-<sp/>ä½æ•ˆ</highlight></codeline>
<codeline><highlight class="normal">void<sp/>sort_by_time()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;DateTime&gt;<sp/>sorted_timestamps;<sp/><sp/><sp/><sp/>//<sp/>âŒ<sp/>é¢å¤–å†…å­˜åˆ†é…</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;T&gt;<sp/>sorted_values;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>âŒ<sp/>é¢å¤–å†…å­˜åˆ†é…</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>...<sp/>æ‹·è´æ•´ä¸ªå‘é‡</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>ä¼˜åŒ–æ–¹æ¡ˆ<sp/>-<sp/>åŸåœ°æ’åº</highlight></codeline>
<codeline><highlight class="normal">void<sp/>sort_by_time()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;size_t&gt;<sp/>indices(timestamps_.size());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::iota(indices.begin(),<sp/>indices.end(),<sp/>0);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::sort(indices.begin(),<sp/>indices.end(),<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[this](size_t<sp/>i,<sp/>size_t<sp/>j)<sp/>{<sp/>return<sp/>timestamps_[i]<sp/>&lt;<sp/>timestamps_[j];<sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>ä½¿ç”¨<sp/>indices<sp/>è¿›è¡ŒåŸåœ°é‡æ’åº</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>apply_permutation(timestamps_,<sp/>indices);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>apply_permutation(values_,<sp/>indices);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>B.<sp/>æ»šåŠ¨æŒ‡æ ‡ç®—æ³•æ•ˆç‡</highlight></codeline>
<codeline><highlight class="normal">**æ–‡ä»¶**:<sp/>`include/pyfolio/performance/rolling_metrics.h:40-68`</highlight></codeline>
<codeline><highlight class="normal">**é—®é¢˜**:<sp/>O(nÂ²)<sp/>å¤æ‚åº¦</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>å½“å‰å®ç°<sp/>-<sp/>O(nÂ²)</highlight></codeline>
<codeline><highlight class="normal">for<sp/>(size_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>values.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>for<sp/>(size_t<sp/>j<sp/>=<sp/>start_idx;<sp/>j<sp/>&lt;=<sp/>i;<sp/>++j)<sp/>{<sp/><sp/><sp/><sp/><sp/>//<sp/>âŒ<sp/>é‡å¤è®¡ç®—</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum<sp/>+=<sp/>values[j];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum_sq<sp/>+=<sp/>values[j]<sp/>*<sp/>values[j];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>ä¼˜åŒ–æ–¹æ¡ˆ<sp/>-<sp/>O(n)<sp/>æ»‘åŠ¨çª—å£</highlight></codeline>
<codeline><highlight class="normal">class<sp/>RollingWindow<sp/>{</highlight></codeline>
<codeline><highlight class="normal">private:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::deque&lt;double&gt;<sp/>window_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>double<sp/>sum_<sp/>=<sp/>0.0;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>double<sp/>sum_sq_<sp/>=<sp/>0.0;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>void<sp/>add_value(double<sp/>value)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(window_.size()<sp/>&gt;=<sp/>window_size_)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>double<sp/>old_value<sp/>=<sp/>window_.front();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>window_.pop_front();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum_<sp/>-=<sp/>old_value;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum_sq_<sp/>-=<sp/>old_value<sp/>*<sp/>old_value;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>window_.push_back(value);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum_<sp/>+=<sp/>value;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum_sq_<sp/>+=<sp/>value<sp/>*<sp/>value;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>double<sp/>mean()<sp/>const<sp/>{<sp/>return<sp/>sum_<sp/>/<sp/>window_.size();<sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>double<sp/>variance()<sp/>const<sp/>{<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>double<sp/>mean_val<sp/>=<sp/>mean();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>(sum_sq_<sp/>/<sp/>window_.size())<sp/>-<sp/>(mean_val<sp/>*<sp/>mean_val);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>2.2<sp/>å†…å­˜ä½¿ç”¨ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>2-3<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>SIMD<sp/>ä¼˜åŒ–æœºä¼š:</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–‡ä»¶:<sp/>include/pyfolio/math/statistics.h</highlight></codeline>
<codeline><highlight class="normal">//<sp/>å½“å‰å®ç°</highlight></codeline>
<codeline><highlight class="normal">double<sp/>calculate_mean(const<sp/>std::vector&lt;double&gt;&amp;<sp/>values)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>std::accumulate(values.begin(),<sp/>values.end(),<sp/>0.0)<sp/>/<sp/>values.size();</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>SIMD<sp/>ä¼˜åŒ–ç‰ˆæœ¬</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;immintrin.h&gt;</highlight></codeline>
<codeline><highlight class="normal">double<sp/>calculate_mean_simd(const<sp/>std::vector&lt;double&gt;&amp;<sp/>values)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>const<sp/>size_t<sp/>simd_size<sp/>=<sp/>4;<sp/>//<sp/>AVX2<sp/>å¯ä»¥å¤„ç†<sp/>4<sp/>ä¸ª<sp/>double</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>const<sp/>size_t<sp/>aligned_size<sp/>=<sp/>(values.size()<sp/>/<sp/>simd_size)<sp/>*<sp/>simd_size;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>__m256d<sp/>sum_vec<sp/>=<sp/>_mm256_setzero_pd();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>for<sp/>(size_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>aligned_size;<sp/>i<sp/>+=<sp/>simd_size)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__m256d<sp/>data<sp/>=<sp/>_mm256_loadu_pd(&amp;values[i]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sum_vec<sp/>=<sp/>_mm256_add_pd(sum_vec,<sp/>data);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>æå–å¹¶æ±‚å’Œ<sp/>SIMD<sp/>ç»“æœ</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>double<sp/>sum_array[4];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>_mm256_storeu_pd(sum_array,<sp/>sum_vec);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>double<sp/>total<sp/>=<sp/>sum_array[0]<sp/>+<sp/>sum_array[1]<sp/>+<sp/>sum_array[2]<sp/>+<sp/>sum_array[3];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>å¤„ç†å‰©ä½™å…ƒç´ </highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>for<sp/>(size_t<sp/>i<sp/>=<sp/>aligned_size;<sp/>i<sp/>&lt;<sp/>values.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>total<sp/>+=<sp/>values[i];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>total<sp/>/<sp/>values.size();</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸŸ <sp/>**ä¼˜å…ˆçº§<sp/>3<sp/>-<sp/>ç°ä»£<sp/>C++<sp/>ç‰¹æ€§<sp/>(Modern<sp/>C++<sp/>-<sp/>ä¸­æœŸå¤„ç†)**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>3.1<sp/>ç¼–è¯‘æ—¶ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>3-4<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>A.<sp/>æ‰©å±•<sp/>`constexpr`<sp/>ä½¿ç”¨</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>å½“å‰<sp/>-<sp/>è¿è¡Œæ—¶è®¡ç®—</highlight></codeline>
<codeline><highlight class="normal">double<sp/>sharpe_ratio(double<sp/>annual_return,<sp/>double<sp/>annual_volatility,<sp/>double<sp/>risk_free_rate<sp/>=<sp/>0.0)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>(annual_return<sp/>-<sp/>risk_free_rate)<sp/>/<sp/>annual_volatility;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>ä¼˜åŒ–<sp/>-<sp/>ç¼–è¯‘æ—¶è®¡ç®—</highlight></codeline>
<codeline><highlight class="normal">constexpr<sp/>double<sp/>sharpe_ratio(double<sp/>annual_return,<sp/>double<sp/>annual_volatility,<sp/>double<sp/>risk_free_rate<sp/>=<sp/>0.0)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>(annual_return<sp/>-<sp/>risk_free_rate)<sp/>/<sp/>annual_volatility;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>ç¼–è¯‘æ—¶å¸¸é‡è®¡ç®—</highlight></codeline>
<codeline><highlight class="normal">constexpr<sp/>double<sp/>TRADING_DAYS_PER_YEAR<sp/>=<sp/>252.0;</highlight></codeline>
<codeline><highlight class="normal">constexpr<sp/>double<sp/>SQRT_TRADING_DAYS<sp/>=<sp/>std::sqrt(TRADING_DAYS_PER_YEAR);<sp/>//<sp/>C++26</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>B.<sp/>æ·»åŠ <sp/>`[[nodiscard]]`<sp/>å±æ€§</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–‡ä»¶:<sp/>include/pyfolio/core/error_handling.h</highlight></codeline>
<codeline><highlight class="normal">template&lt;typename<sp/>T&gt;</highlight></codeline>
<codeline><highlight class="normal">class<sp/>[[nodiscard]]<sp/>Result<sp/>{<sp/><sp/>//<sp/>âœ…<sp/>é˜²æ­¢æ„å¤–å¿½ç•¥ç»“æœ</highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>[[nodiscard]]<sp/>bool<sp/>is_success()<sp/>const<sp/>noexcept;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>[[nodiscard]]<sp/>bool<sp/>is_error()<sp/>const<sp/>noexcept;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>[[nodiscard]]<sp/>const<sp/>T&amp;<sp/>value()<sp/>const&amp;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>[[nodiscard]]<sp/>T&amp;&amp;<sp/>value()<sp/>&amp;&amp;;</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>æ€§èƒ½å…³é”®å‡½æ•°</highlight></codeline>
<codeline><highlight class="normal">[[nodiscard]]<sp/>Result&lt;double&gt;<sp/>calculate_volatility(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal">[[nodiscard]]<sp/>Result&lt;double&gt;<sp/>calculate_max_drawdown(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns);</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>3.2<sp/>ç±»å‹å®‰å…¨å¢å¼º</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>2-3<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>std::span<sp/>è§†å›¾ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>å½“å‰<sp/>-<sp/>åˆ›å»ºä¸´æ—¶å¯¹è±¡</highlight></codeline>
<codeline><highlight class="normal">TimeSeries&lt;double&gt;<sp/>get_window(size_t<sp/>start,<sp/>size_t<sp/>end)<sp/>const<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;DateTime&gt;<sp/>window_timestamps(timestamps_.begin()<sp/>+<sp/>start,<sp/>timestamps_.begin()<sp/>+<sp/>end);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;double&gt;<sp/>window_values(values_.begin()<sp/>+<sp/>start,<sp/>values_.begin()<sp/>+<sp/>end);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>TimeSeries&lt;double&gt;(std::move(window_timestamps),<sp/>std::move(window_values));</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>ä¼˜åŒ–<sp/>-<sp/>é›¶æ‹·è´è§†å›¾</highlight></codeline>
<codeline><highlight class="normal">std::pair&lt;std::span&lt;const<sp/>DateTime&gt;,<sp/>std::span&lt;const<sp/>double&gt;&gt;<sp/></highlight></codeline>
<codeline><highlight class="normal">get_window_view(size_t<sp/>start,<sp/>size_t<sp/>end)<sp/>const<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::span&lt;const<sp/>DateTime&gt;{timestamps_.data()<sp/>+<sp/>start,<sp/>end<sp/>-<sp/>start},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::span&lt;const<sp/>double&gt;{values_.data()<sp/>+<sp/>start,<sp/>end<sp/>-<sp/>start}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>å¼ºåŒ–<sp/>Concepts</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–‡ä»¶:<sp/>include/pyfolio/core/types.h</highlight></codeline>
<codeline><highlight class="normal">//<sp/>å½“å‰æ¦‚å¿µå®šä¹‰</highlight></codeline>
<codeline><highlight class="normal">template&lt;typename<sp/>T&gt;</highlight></codeline>
<codeline><highlight class="normal">concept<sp/>Numeric<sp/>=<sp/>std::is_arithmetic_v&lt;T&gt;;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>å¢å¼ºçš„æ¦‚å¿µå®šä¹‰</highlight></codeline>
<codeline><highlight class="normal">template&lt;typename<sp/>T&gt;</highlight></codeline>
<codeline><highlight class="normal">concept<sp/>FinancialValue<sp/>=<sp/>requires(T<sp/>t)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>t.value()<sp/>}<sp/>-&gt;<sp/>std::convertible_to&lt;double&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>T::zero()<sp/>}<sp/>-&gt;<sp/>std::same_as&lt;T&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>t<sp/>+<sp/>t<sp/>}<sp/>-&gt;<sp/>std::same_as&lt;T&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>t<sp/>-<sp/>t<sp/>}<sp/>-&gt;<sp/>std::same_as&lt;T&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>t<sp/>*<sp/>2.0<sp/>}<sp/>-&gt;<sp/>std::same_as&lt;T&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>t<sp/>/<sp/>2.0<sp/>}<sp/>-&gt;<sp/>std::same_as&lt;T&gt;;</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">template&lt;typename<sp/>T&gt;</highlight></codeline>
<codeline><highlight class="normal">concept<sp/>TimeSeriesValue<sp/>=<sp/>FinancialValue&lt;T&gt;<sp/>&amp;&amp;<sp/>requires<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>typename<sp/>T::value_type;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::is_default_constructible_v&lt;T&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::is_copy_constructible_v&lt;T&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::is_move_constructible_v&lt;T&gt;;</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸ”µ<sp/>**ä¼˜å…ˆçº§<sp/>4<sp/>-<sp/>åŠŸèƒ½å¢å¼º<sp/>(Features<sp/>-<sp/>ä¸­é•¿æœŸå¤„ç†)**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>4.1<sp/>ç¼ºå¤±çš„<sp/>Python<sp/>åŠŸèƒ½</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>8-12<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>A.<sp/>Web<sp/>æ¡†æ¶é›†æˆ<sp/>(æ›¿ä»£<sp/>Flask)</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–°æ–‡ä»¶:<sp/>include/pyfolio/web/server.h</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;crow.h&gt;<sp/><sp/>//<sp/>è½»é‡çº§<sp/>C++<sp/>web<sp/>æ¡†æ¶</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">class<sp/>PyfolioWebServer<sp/>{</highlight></codeline>
<codeline><highlight class="normal">private:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>crow::SimpleApp<sp/>app_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>void<sp/>setup_routes()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>ä¸»é¡µè·¯ç”±</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CROW_ROUTE(app_,<sp/>&quot;/&quot;)([](){</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>crow::load_text(&quot;templates/index.html&quot;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>API<sp/>è·¯ç”±</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CROW_ROUTE(app_,<sp/>&quot;/api/analysis&quot;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.methods(&quot;POST&quot;_method)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>([this](const<sp/>crow::request&amp;<sp/>req)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>generate_analysis_json(req.body);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>é™æ€æ–‡ä»¶æœåŠ¡</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CROW_ROUTE(app_,<sp/>&quot;/static/&lt;path&gt;&quot;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>([](const<sp/>std::string&amp;<sp/>path)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>crow::load_text(&quot;static/&quot;<sp/>+<sp/>path);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>void<sp/>start(int<sp/>port<sp/>=<sp/>8080)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>app_.port(port).multithreaded().run();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">private:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>crow::response<sp/>generate_analysis_json(const<sp/>std::string&amp;<sp/>request_data);</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>B.<sp/>å¢å¼ºçš„å¯è§†åŒ–åŠŸèƒ½</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–‡ä»¶:<sp/>include/pyfolio/visualization/plotly_integration.h</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;nlohmann/json.hpp&gt;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">class<sp/>PlotlyChart<sp/>{</highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>static<sp/>nlohmann::json<sp/>create_returns_chart(const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nlohmann::json<sp/>chart;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chart[&quot;data&quot;]<sp/>=<sp/>nlohmann::json::array();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>auto&amp;<sp/>trace<sp/>=<sp/>chart[&quot;data&quot;][0];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trace[&quot;type&quot;]<sp/>=<sp/>&quot;scatter&quot;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trace[&quot;mode&quot;]<sp/>=<sp/>&quot;lines&quot;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>è½¬æ¢æ—¶é—´åºåˆ—æ•°æ®</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>(const<sp/>auto&amp;<sp/>[timestamp,<sp/>value]<sp/>:<sp/>returns)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trace[&quot;x&quot;].push_back(timestamp.to_iso_string());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>trace[&quot;y&quot;].push_back(value);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chart[&quot;layout&quot;][&quot;title&quot;]<sp/>=<sp/>&quot;Portfolio<sp/>Returns&quot;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chart[&quot;layout&quot;][&quot;xaxis&quot;][&quot;title&quot;]<sp/>=<sp/>&quot;Date&quot;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chart[&quot;layout&quot;][&quot;yaxis&quot;][&quot;title&quot;]<sp/>=<sp/>&quot;Returns&quot;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>chart;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>static<sp/>std::string<sp/>to_html(const<sp/>nlohmann::json&amp;<sp/>chart)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::string<sp/>html<sp/>=<sp/>R&quot;(</highlight></codeline>
<codeline><highlight class="normal">&lt;!DOCTYPE<sp/>html&gt;</highlight></codeline>
<codeline><highlight class="normal">&lt;html&gt;</highlight></codeline>
<codeline><highlight class="normal">&lt;head&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;script<sp/>src=&quot;https://cdn.plot.ly/plotly-latest.min.js&quot;&gt;&lt;/script&gt;</highlight></codeline>
<codeline><highlight class="normal">&lt;/head&gt;</highlight></codeline>
<codeline><highlight class="normal">&lt;body&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;div<sp/>id=&quot;chart&quot;&gt;&lt;/div&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;script&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Plotly.newPlot(&apos;chart&apos;,<sp/>)&quot;<sp/>+<sp/>chart.dump()<sp/>+<sp/>R&quot;();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&lt;/script&gt;</highlight></codeline>
<codeline><highlight class="normal">&lt;/body&gt;</highlight></codeline>
<codeline><highlight class="normal">&lt;/html&gt;)&quot;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>html;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>4.2<sp/>é«˜çº§åˆ†æåŠŸèƒ½</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>6-8<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>A.<sp/>æœºå™¨å­¦ä¹ é›†æˆ</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–°æ–‡ä»¶:<sp/>include/pyfolio/ml/regime_ml.h</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;dlib/svm.h&gt;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">class<sp/>MLRegimeDetector<sp/>{</highlight></codeline>
<codeline><highlight class="normal">private:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>using<sp/>sample_type<sp/>=<sp/>dlib::matrix&lt;double,<sp/>0,<sp/>1&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>using<sp/>kernel_type<sp/>=<sp/>dlib::radial_basis_kernel&lt;sample_type&gt;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>dlib::svm_c_trainer&lt;kernel_type&gt;<sp/>trainer_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>Result&lt;RegimeClassification&gt;<sp/>detect_regimes_ml(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>TimeSeries&lt;double&gt;&amp;<sp/>returns,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>std::vector&lt;FeatureVector&gt;&amp;<sp/>features)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>ç‰¹å¾å·¥ç¨‹</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;sample_type&gt;<sp/>samples;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;double&gt;<sp/>labels;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>(const<sp/>auto&amp;<sp/>feature<sp/>:<sp/>features)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sample_type<sp/>sample;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sample.set_size(feature.size());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>(size_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>feature.size();<sp/>++i)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sample(i)<sp/>=<sp/>feature[i];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>samples.push_back(sample);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>è®­ç»ƒ<sp/>SVM<sp/>æ¨¡å‹</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>auto<sp/>decision_function<sp/>=<sp/>trainer_.train(samples,<sp/>labels);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>åº”ç”¨æ¨¡å‹è¿›è¡Œåˆ†ç±»</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>RegimeClassification<sp/>result;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>(const<sp/>auto&amp;<sp/>sample<sp/>:<sp/>samples)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result.regimes.push_back(decision_function(sample));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>Success{result};</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>B.<sp/>å®æ—¶åˆ†ææ”¯æŒ</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–°æ–‡ä»¶:<sp/>include/pyfolio/realtime/streaming.h</highlight></codeline>
<codeline><highlight class="normal">template&lt;typename<sp/>T&gt;</highlight></codeline>
<codeline><highlight class="normal">class<sp/>StreamingAnalyzer<sp/>{</highlight></codeline>
<codeline><highlight class="normal">private:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>RollingWindow&lt;T&gt;<sp/>window_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::vector&lt;std::function&lt;void(const<sp/>AnalysisResult&amp;)&gt;&gt;<sp/>callbacks_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>void<sp/>add_data_point(const<sp/>DateTime&amp;<sp/>timestamp,<sp/>const<sp/>T&amp;<sp/>value)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>window_.add(timestamp,<sp/>value);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(window_.size()<sp/>&gt;=<sp/>min_window_size_)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>auto<sp/>analysis<sp/>=<sp/>perform_analysis();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>notify_callbacks(analysis);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>void<sp/>subscribe(std::function&lt;void(const<sp/>AnalysisResult&amp;)&gt;<sp/>callback)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>callbacks_.push_back(std::move(callback));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">private:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>AnalysisResult<sp/>perform_analysis()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AnalysisResult<sp/>result;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result.sharpe_ratio<sp/>=<sp/>calculate_sharpe_ratio(window_.returns());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result.max_drawdown<sp/>=<sp/>calculate_max_drawdown(window_.returns());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result.volatility<sp/>=<sp/>calculate_volatility(window_.returns());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>result;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>void<sp/>notify_callbacks(const<sp/>AnalysisResult&amp;<sp/>result)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>(auto&amp;<sp/>callback<sp/>:<sp/>callbacks_)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>callback(result);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸŸ¢<sp/>**ä¼˜å…ˆçº§<sp/>5<sp/>-<sp/>è´¨é‡æå‡<sp/>(Quality<sp/>-<sp/>é•¿æœŸå¤„ç†)**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>5.1<sp/>æµ‹è¯•è¦†ç›–ç‡æå‡</highlight></codeline>
<codeline><highlight class="normal">**ç›®æ ‡**:<sp/>ä»<sp/>60-70%<sp/>æå‡åˆ°<sp/>95%+</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>5-7<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>A.<sp/>è¾¹ç•Œæ¡ä»¶æµ‹è¯•</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–‡ä»¶:<sp/>tests/test_edge_cases.cpp</highlight></codeline>
<codeline><highlight class="normal">TEST(PerformanceMetrics,<sp/>EmptyTimeSeries)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>TimeSeries&lt;double&gt;<sp/>empty_series;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>result<sp/>=<sp/>calculate_sharpe_ratio(empty_series);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>EXPECT_TRUE(result.is_error());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>EXPECT_EQ(result.error().code,<sp/>ErrorCode::INSUFFICIENT_DATA);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">TEST(PerformanceMetrics,<sp/>SingleDataPoint)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>TimeSeries&lt;double&gt;<sp/>single_point;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>single_point.add(DateTime::now(),<sp/>0.05);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>result<sp/>=<sp/>calculate_volatility(single_point);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>EXPECT_TRUE(result.is_error());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>EXPECT_EQ(result.error().code,<sp/>ErrorCode::INSUFFICIENT_DATA);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">TEST(PerformanceMetrics,<sp/>NaNHandling)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>TimeSeries&lt;double&gt;<sp/>series_with_nan;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>series_with_nan.add(DateTime::now(),<sp/>0.05);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>series_with_nan.add(DateTime::now()<sp/>+<sp/>std::chrono::days(1),<sp/>std::numeric_limits&lt;double&gt;::quiet_NaN());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>result<sp/>=<sp/>calculate_mean(series_with_nan);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>EXPECT_TRUE(result.is_error());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>EXPECT_EQ(result.error().code,<sp/>ErrorCode::INVALID_DATA);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>B.<sp/>æ€§èƒ½å›å½’æµ‹è¯•</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">//<sp/>æ–‡ä»¶:<sp/>tests/test_performance_regression.cpp</highlight></codeline>
<codeline><highlight class="normal">class<sp/>PerformanceBenchmark<sp/>:<sp/>public<sp/>::testing::Test<sp/>{</highlight></codeline>
<codeline><highlight class="normal">protected:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>TimeSeries&lt;double&gt;<sp/>large_series_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>void<sp/>SetUp()<sp/>override<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>ç”Ÿæˆ<sp/>100,000<sp/>ä¸ªæ•°æ®ç‚¹</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>(int<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>100000;<sp/>++i)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>large_series_.add(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DateTime::from_days_since_epoch(i),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>random_normal_distribution_(generator_)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">TEST_F(PerformanceBenchmark,<sp/>SharpeRatioPerformance)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>start<sp/>=<sp/>std::chrono::high_resolution_clock::now();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>result<sp/>=<sp/>calculate_sharpe_ratio(large_series_);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>end<sp/>=<sp/>std::chrono::high_resolution_clock::now();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>duration<sp/>=<sp/>std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end<sp/>-<sp/>start);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>EXPECT_TRUE(result.is_success());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>EXPECT_LT(duration.count(),<sp/>100);<sp/>//<sp/>åº”è¯¥åœ¨<sp/>100ms<sp/>å†…å®Œæˆ</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>5.2<sp/>ä»£ç è´¨é‡å·¥å…·é›†æˆ</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>2-3<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>A.<sp/>é™æ€ä»£ç åˆ†æ</highlight></codeline>
<codeline><highlight class="normal">```cmake</highlight></codeline>
<codeline><highlight class="normal">#<sp/>CMakeLists.txt<sp/>å¢å¼º</highlight></codeline>
<codeline><highlight class="normal">find_program(CLANG_TIDY_EXE<sp/>NAMES<sp/>&quot;clang-tidy&quot;)</highlight></codeline>
<codeline><highlight class="normal">if(CLANG_TIDY_EXE)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>set(CMAKE_CXX_CLANG_TIDY<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>${CLANG_TIDY_EXE};</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-checks=*,-fuchsia-*,-google-*,-zircon-*,-abseil-*,-llvm-header-guard;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-header-filter=.*pyfolio.*</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal">endif()</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">find_program(CPPCHECK_EXE<sp/>NAMES<sp/>&quot;cppcheck&quot;)</highlight></codeline>
<codeline><highlight class="normal">if(CPPCHECK_EXE)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>add_custom_target(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cppcheck</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>COMMAND<sp/>${CPPCHECK_EXE}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--enable=warning,performance,portability</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--std=c++20</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--template=&quot;[{severity}][{id}]<sp/>{message}<sp/>{callstack}<sp/>\(On<sp/>{file}:{line}\)&quot;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--verbose</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--quiet</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>${CMAKE_SOURCE_DIR}/include</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal">endif()</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>B.<sp/>ä»£ç æ ¼å¼åŒ–æ ‡å‡†åŒ–</highlight></codeline>
<codeline><highlight class="normal">```yaml</highlight></codeline>
<codeline><highlight class="normal">#<sp/>.clang-format</highlight></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline><highlight class="normal">Language:<sp/>Cpp</highlight></codeline>
<codeline><highlight class="normal">BasedOnStyle:<sp/>Google</highlight></codeline>
<codeline><highlight class="normal">IndentWidth:<sp/>4</highlight></codeline>
<codeline><highlight class="normal">TabWidth:<sp/>4</highlight></codeline>
<codeline><highlight class="normal">UseTab:<sp/>Never</highlight></codeline>
<codeline><highlight class="normal">ColumnLimit:<sp/>100</highlight></codeline>
<codeline><highlight class="normal">AlignAfterOpenBracket:<sp/>Align</highlight></codeline>
<codeline><highlight class="normal">AlignConsecutiveAssignments:<sp/>true</highlight></codeline>
<codeline><highlight class="normal">AlignConsecutiveDeclarations:<sp/>true</highlight></codeline>
<codeline><highlight class="normal">AllowShortFunctionsOnASingleLine:<sp/>Empty</highlight></codeline>
<codeline><highlight class="normal">AllowShortIfStatementsOnASingleLine:<sp/>false</highlight></codeline>
<codeline><highlight class="normal">AlwaysBreakTemplateDeclarations:<sp/>true</highlight></codeline>
<codeline><highlight class="normal">BreakBeforeBraces:<sp/>Attach</highlight></codeline>
<codeline><highlight class="normal">BreakConstructorInitializers:<sp/>BeforeColon</highlight></codeline>
<codeline><highlight class="normal">IncludeBlocks:<sp/>Regroup</highlight></codeline>
<codeline><highlight class="normal">NamespaceIndentation:<sp/>None</highlight></codeline>
<codeline><highlight class="normal">PointerAlignment:<sp/>Left</highlight></codeline>
<codeline><highlight class="normal">SpaceAfterCStyleCast:<sp/>false</highlight></codeline>
<codeline><highlight class="normal">SpaceAfterTemplateKeyword:<sp/>true</highlight></codeline>
<codeline><highlight class="normal">SpaceBeforeAssignmentOperators:<sp/>true</highlight></codeline>
<codeline><highlight class="normal">SpaceBeforeCpp11BracedList:<sp/>false</highlight></codeline>
<codeline><highlight class="normal">SpaceBeforeParens:<sp/>ControlStatements</highlight></codeline>
<codeline><highlight class="normal">SpaceInEmptyParentheses:<sp/>false</highlight></codeline>
<codeline><highlight class="normal">Standard:<sp/>c++20</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>5.3<sp/>æ–‡æ¡£å®Œå–„</highlight></codeline>
<codeline><highlight class="normal">**é¢„è®¡å·¥ä½œé‡**:<sp/>4-5<sp/>å·¥ä½œæ—¥</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">####<sp/>A.<sp/>API<sp/>æ–‡æ¡£ç”Ÿæˆ</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@file<sp/>performance_metrics.h</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@brief<sp/>Portfolio<sp/>performance<sp/>metrics<sp/>calculation</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@author<sp/>Pyfolio<sp/>C++<sp/>Team</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@date<sp/>2024</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@class<sp/>PerformanceCalculator</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@brief<sp/>High-performance<sp/>portfolio<sp/>metrics<sp/>calculator</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>This<sp/>class<sp/>provides<sp/>optimized<sp/>implementations<sp/>of<sp/>common<sp/>portfolio</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>performance<sp/>metrics<sp/>using<sp/>modern<sp/>C++20<sp/>features<sp/>and<sp/>SIMD<sp/>optimization.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@tparam<sp/>T<sp/>Numeric<sp/>type<sp/>for<sp/>calculations<sp/>(double,<sp/>float)</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@example</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@code</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>TimeSeries&lt;double&gt;<sp/>returns<sp/>=<sp/>load_returns(&quot;portfolio.csv&quot;);</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>PerformanceCalculator&lt;double&gt;<sp/>calc;</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>auto<sp/>sharpe<sp/>=<sp/>calc.sharpe_ratio(returns);</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>if<sp/>(sharpe.is_success())<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/><sp/><sp/>std::cout<sp/>&lt;&lt;<sp/>&quot;Sharpe<sp/>Ratio:<sp/>&quot;<sp/>&lt;&lt;<sp/>sharpe.value()<sp/>&lt;&lt;<sp/>std::endl;</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@endcode</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">template&lt;Numeric<sp/>T&gt;</highlight></codeline>
<codeline><highlight class="normal">class<sp/>PerformanceCalculator<sp/>{</highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@brief<sp/>Calculate<sp/>annualized<sp/>Sharpe<sp/>ratio</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>Computes<sp/>the<sp/>risk-adjusted<sp/>return<sp/>using<sp/>the<sp/>formula:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>(Annual<sp/>Return<sp/>-<sp/>Risk<sp/>Free<sp/>Rate)<sp/>/<sp/>Annual<sp/>Volatility</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@param<sp/>returns<sp/>Time<sp/>series<sp/>of<sp/>periodic<sp/>returns</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@param<sp/>risk_free_rate<sp/>Annual<sp/>risk-free<sp/>rate<sp/>(default:<sp/>0.0)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@param<sp/>periods_per_year<sp/>Number<sp/>of<sp/>periods<sp/>per<sp/>year<sp/>(default:<sp/>252<sp/>for<sp/>daily)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@return<sp/>Result&lt;T&gt;<sp/>Sharpe<sp/>ratio<sp/>on<sp/>success,<sp/>error<sp/>on<sp/>failure</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@throws<sp/>Never<sp/>throws<sp/>exceptions,<sp/>uses<sp/>Result&lt;T&gt;<sp/>pattern</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@complexity<sp/>O(n)<sp/>where<sp/>n<sp/>is<sp/>the<sp/>number<sp/>of<sp/>returns</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@memory<sp/>O(1)<sp/>additional<sp/>memory<sp/>usage</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@pre<sp/>returns.size()<sp/>&gt;=<sp/>2</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@pre<sp/>std::isfinite(risk_free_rate)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@pre<sp/>periods_per_year<sp/>&gt;<sp/>0</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>@post<sp/>Result<sp/>is<sp/>valid<sp/>sharpe<sp/>ratio<sp/>or<sp/>error<sp/>with<sp/>specific<sp/>code</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>[[nodiscard]]<sp/>Result&lt;T&gt;<sp/>sharpe_ratio(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>const<sp/>TimeSeries&lt;T&gt;&amp;<sp/>returns,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/>risk_free_rate<sp/>=<sp/>T{0.0},</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>size_t<sp/>periods_per_year<sp/>=<sp/>252</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>const<sp/>noexcept;</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸ“Š<sp/>**å®æ–½ä¼˜å…ˆçº§çŸ©é˜µ**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">|<sp/>ç±»åˆ«<sp/>|<sp/>å·¥ä½œé‡<sp/>|<sp/>ä¸šåŠ¡å½±å“<sp/>|<sp/>æŠ€æœ¯å½±å“<sp/>|<sp/>æ¨èé¡ºåº<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|------|--------|----------|----------|----------|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>API<sp/>å…¼å®¹æ€§ä¿®å¤<sp/>|<sp/>3-5å¤©<sp/>|<sp/>ğŸ”´<sp/>é«˜<sp/>|<sp/>ğŸ”´<sp/>é«˜<sp/>|<sp/>1<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>ç¼ºå¤±å®ç°è¡¥å…¨<sp/>|<sp/>5-7å¤©<sp/>|<sp/>ğŸ”´<sp/>é«˜<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>2<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>é”™è¯¯å¤„ç†ä¸€è‡´æ€§<sp/>|<sp/>2-3å¤©<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>ğŸ”´<sp/>é«˜<sp/>|<sp/>3<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–<sp/>|<sp/>4-6å¤©<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>ğŸ”´<sp/>é«˜<sp/>|<sp/>4<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>å†…å­˜ä½¿ç”¨ä¼˜åŒ–<sp/>|<sp/>2-3å¤©<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>5<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>ç°ä»£<sp/>C++<sp/>ç‰¹æ€§<sp/>|<sp/>3-4å¤©<sp/>|<sp/>ğŸŸ¢<sp/>ä½<sp/>|<sp/>ğŸ”´<sp/>é«˜<sp/>|<sp/>6<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>ç±»å‹å®‰å…¨å¢å¼º<sp/>|<sp/>2-3å¤©<sp/>|<sp/>ğŸŸ¢<sp/>ä½<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>7<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>Web<sp/>æ¡†æ¶é›†æˆ<sp/>|<sp/>8-12å¤©<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>ğŸŸ¢<sp/>ä½<sp/>|<sp/>8<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>é«˜çº§åˆ†æåŠŸèƒ½<sp/>|<sp/>6-8å¤©<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>ğŸŸ¢<sp/>ä½<sp/>|<sp/>9<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>æµ‹è¯•è¦†ç›–ç‡æå‡<sp/>|<sp/>5-7å¤©<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>10<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>ä»£ç è´¨é‡å·¥å…·<sp/>|<sp/>2-3å¤©<sp/>|<sp/>ğŸŸ¢<sp/>ä½<sp/>|<sp/>ğŸŸ¡<sp/>ä¸­<sp/>|<sp/>11<sp/>|</highlight></codeline>
<codeline><highlight class="normal">|<sp/>æ–‡æ¡£å®Œå–„<sp/>|<sp/>4-5å¤©<sp/>|<sp/>ğŸŸ¢<sp/>ä½<sp/>|<sp/>ğŸŸ¢<sp/>ä½<sp/>|<sp/>12<sp/>|</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**æ€»é¢„è®¡å·¥ä½œé‡**:<sp/>47-66<sp/>å·¥ä½œæ—¥<sp/>(çº¦<sp/>2-3<sp/>ä¸ªæœˆ)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸ¯<sp/>**é˜¶æ®µæ€§ç›®æ ‡**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>ç¬¬ä¸€é˜¶æ®µ<sp/>(ç¬¬<sp/>1-2<sp/>å‘¨):<sp/>åŸºç¡€ä¿®å¤</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>ä¿®å¤æ‰€æœ‰<sp/>API<sp/>å…¼å®¹æ€§é—®é¢˜</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>è¡¥å…¨<sp/>MarketIndicators<sp/>å’Œ<sp/>RegimeDetection<sp/>å®ç°</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å¼</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**ç›®æ ‡**:<sp/>æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°<sp/>80%</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>ç¬¬äºŒé˜¶æ®µ<sp/>(ç¬¬<sp/>3-4<sp/>å‘¨):<sp/>æ€§èƒ½ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>å®æ–½ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>å†…å­˜ä½¿ç”¨ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>SIMD<sp/>æŒ‡ä»¤é›†æˆ</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**ç›®æ ‡**:<sp/>æ€§èƒ½æå‡<sp/>2-5xï¼Œå†…å­˜ä½¿ç”¨å‡å°‘<sp/>30%</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>ç¬¬ä¸‰é˜¶æ®µ<sp/>(ç¬¬<sp/>5-8<sp/>å‘¨):<sp/>åŠŸèƒ½å¢å¼º</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>ç°ä»£<sp/>C++<sp/>ç‰¹æ€§é›†æˆ</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>Web<sp/>æ¡†æ¶å¼€å‘</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>é«˜çº§åˆ†æåŠŸèƒ½å®ç°</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**ç›®æ ‡**:<sp/>åŠŸèƒ½è¦†ç›–ç‡è¾¾åˆ°<sp/>95%ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>ç¬¬å››é˜¶æ®µ<sp/>(ç¬¬<sp/>9-12<sp/>å‘¨):<sp/>è´¨é‡æå‡</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>æµ‹è¯•è¦†ç›–ç‡æå‡åˆ°<sp/>95%+</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>ä»£ç è´¨é‡å·¥å…·é›†æˆ</highlight></codeline>
<codeline><highlight class="normal">-<sp/>âœ…<sp/>å®Œæ•´æ–‡æ¡£ç¼–å†™</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**ç›®æ ‡**:<sp/>ç”Ÿäº§å°±ç»ªï¼Œå‘å¸ƒ<sp/>v1.0</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸ”§<sp/>**å¼€å‘ç¯å¢ƒå»ºè®®**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>æ„å»ºç³»ç»Ÿä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">```cmake</highlight></codeline>
<codeline><highlight class="normal">#<sp/>CMakeLists.txt<sp/>å¢å¼ºç‰ˆæœ¬</highlight></codeline>
<codeline><highlight class="normal">cmake_minimum_required(VERSION<sp/>3.20)</highlight></codeline>
<codeline><highlight class="normal">project(pyfolio_cpp<sp/>VERSION<sp/>1.0.0<sp/>LANGUAGES<sp/>CXX)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">#<sp/>ç°ä»£<sp/>C++<sp/>æ ‡å‡†</highlight></codeline>
<codeline><highlight class="normal">set(CMAKE_CXX_STANDARD<sp/>20)</highlight></codeline>
<codeline><highlight class="normal">set(CMAKE_CXX_STANDARD_REQUIRED<sp/>ON)</highlight></codeline>
<codeline><highlight class="normal">set(CMAKE_CXX_EXTENSIONS<sp/>OFF)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">#<sp/>ç¼–è¯‘å™¨ä¼˜åŒ–é€‰é¡¹</highlight></codeline>
<codeline><highlight class="normal">if(CMAKE_CXX_COMPILER_ID<sp/>MATCHES<sp/>&quot;GNU|Clang&quot;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>target_compile_options(pyfolio_cpp<sp/>PRIVATE</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-Wall<sp/>-Wextra<sp/>-Wpedantic</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-march=native<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>CPU<sp/>æ¶æ„ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-O3<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>æœ€é«˜ä¼˜åŒ–çº§åˆ«</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-DNDEBUG<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>Release<sp/>æ¨¡å¼</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-flto<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>é“¾æ¥æ—¶ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal">endif()</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">#<sp/>åˆ†æå’Œè°ƒè¯•å·¥å…·</highlight></codeline>
<codeline><highlight class="normal">option(ENABLE_SANITIZERS<sp/>&quot;Enable<sp/>address<sp/>and<sp/>undefined<sp/>behavior<sp/>sanitizers&quot;<sp/>OFF)</highlight></codeline>
<codeline><highlight class="normal">if(ENABLE_SANITIZERS)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>target_compile_options(pyfolio_cpp<sp/>PRIVATE<sp/>-fsanitize=address,undefined)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>target_link_options(pyfolio_cpp<sp/>PRIVATE<sp/>-fsanitize=address,undefined)</highlight></codeline>
<codeline><highlight class="normal">endif()</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">option(ENABLE_PROFILING<sp/>&quot;Enable<sp/>profiling<sp/>support&quot;<sp/>OFF)</highlight></codeline>
<codeline><highlight class="normal">if(ENABLE_PROFILING)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>target_compile_options(pyfolio_cpp<sp/>PRIVATE<sp/>-pg)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>target_link_options(pyfolio_cpp<sp/>PRIVATE<sp/>-pg)</highlight></codeline>
<codeline><highlight class="normal">endif()</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>æŒç»­é›†æˆé…ç½®</highlight></codeline>
<codeline><highlight class="normal">```yaml</highlight></codeline>
<codeline><highlight class="normal">#<sp/>.github/workflows/ci.yml</highlight></codeline>
<codeline><highlight class="normal">name:<sp/>CI</highlight></codeline>
<codeline><highlight class="normal">on:<sp/>[push,<sp/>pull_request]</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">jobs:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>test:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>strategy:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>matrix:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>os:<sp/>[ubuntu-latest,<sp/>macos-latest,<sp/>windows-latest]</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>compiler:<sp/>[gcc-11,<sp/>clang-14]</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>build_type:<sp/>[Debug,<sp/>Release]</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>runs-on:<sp/>${{<sp/>matrix.os<sp/>}}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>steps:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-<sp/>uses:<sp/>actions/checkout@v3</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-<sp/>name:<sp/>Install<sp/>dependencies</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>run:<sp/>|</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sudo<sp/>apt-get<sp/>update</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sudo<sp/>apt-get<sp/>install<sp/>-y<sp/>cmake<sp/>ninja-build<sp/>lcov</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-<sp/>name:<sp/>Configure</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>run:<sp/>|</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmake<sp/>-B<sp/>build<sp/>-G<sp/>Ninja<sp/>\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-DCMAKE_BUILD_TYPE=${{<sp/>matrix.build_type<sp/>}}<sp/>\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-DENABLE_TESTING=ON<sp/>\</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-DENABLE_COVERAGE=ON</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-<sp/>name:<sp/>Build</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>run:<sp/>cmake<sp/>--build<sp/>build<sp/>--parallel</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-<sp/>name:<sp/>Test</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>run:<sp/>|</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cd<sp/>build</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctest<sp/>--output-on-failure<sp/>--parallel</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-<sp/>name:<sp/>Coverage</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if:<sp/>matrix.build_type<sp/>==<sp/>&apos;Debug&apos;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>run:<sp/>|</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cd<sp/>build</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>make<sp/>coverage</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bash<sp/>&lt;(curl<sp/>-s<sp/>https://codecov.io/bash)</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸ“ˆ<sp/>**é¢„æœŸæ”¶ç›Š**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>æ€§èƒ½æå‡</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**è®¡ç®—æ€§èƒ½**:<sp/>10-100x<sp/>æå‡<sp/>(å·²å®ç°éƒ¨åˆ†)</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**å†…å­˜æ•ˆç‡**:<sp/>50%<sp/>å‡å°‘<sp/>(å·²å®ç°éƒ¨åˆ†)<sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">-<sp/>**ç¼–è¯‘æ—¶ä¼˜åŒ–**:<sp/>20-30%<sp/>æ„å»ºæ—¶é—´å‡å°‘</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**è¿è¡Œæ—¶å®‰å…¨**:<sp/>0<sp/>å´©æºƒç‡<sp/>(é€šè¿‡<sp/>Result&lt;T&gt;<sp/>æ¨¡å¼)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>å¼€å‘æ•ˆç‡</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**API<sp/>ä¸€è‡´æ€§**:<sp/>100%<sp/>å…¼å®¹æ€§</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**ç±»å‹å®‰å…¨**:<sp/>ç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**æµ‹è¯•è¦†ç›–**:<sp/>95%+<sp/>ä»£ç è¦†ç›–ç‡</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**æ–‡æ¡£å®Œæ•´æ€§**:<sp/>100%<sp/>API<sp/>æ–‡æ¡£è¦†ç›–</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>ç»´æŠ¤æ€§</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**ä»£ç è´¨é‡**:<sp/>A+<sp/>ç­‰çº§<sp/>(é€šè¿‡é™æ€åˆ†æ)</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**æŠ€æœ¯å€ºåŠ¡**:<sp/>æœ€å°åŒ–</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**æ‰©å±•æ€§**:<sp/>æ”¯æŒæ–°åŠŸèƒ½å¿«é€Ÿå¼€å‘</highlight></codeline>
<codeline><highlight class="normal">-<sp/>**ç¤¾åŒºè´¡çŒ®**:<sp/>æ¸…æ™°çš„è´¡çŒ®æŒ‡å—</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸ’¡<sp/>**åˆ›æ–°ç‰¹æ€§å»ºè®®**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>1.<sp/>æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">template&lt;typename<sp/>KeyType,<sp/>typename<sp/>ValueType&gt;</highlight></codeline>
<codeline><highlight class="normal">class<sp/>IntelligentCache<sp/>{</highlight></codeline>
<codeline><highlight class="normal">private:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>mutable<sp/>std::shared_mutex<sp/>cache_mutex_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::unordered_map&lt;KeyType,<sp/>std::pair&lt;ValueType,<sp/>std::chrono::steady_clock::time_point&gt;&gt;<sp/>cache_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::chrono::seconds<sp/>ttl_;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>std::optional&lt;ValueType&gt;<sp/>get(const<sp/>KeyType&amp;<sp/>key)<sp/>const<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::shared_lock<sp/>lock(cache_mutex_);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>auto<sp/>it<sp/>=<sp/>cache_.find(key);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(it<sp/>!=<sp/>cache_.end())<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>auto<sp/>now<sp/>=<sp/>std::chrono::steady_clock::now();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(now<sp/>-<sp/>it-&gt;second.second<sp/>&lt;<sp/>ttl_)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>it-&gt;second.first;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>std::nullopt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>void<sp/>put(const<sp/>KeyType&amp;<sp/>key,<sp/>const<sp/>ValueType&amp;<sp/>value)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::unique_lock<sp/>lock(cache_mutex_);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cache_[key]<sp/>=<sp/>{value,<sp/>std::chrono::steady_clock::now()};</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>2.<sp/>è‡ªé€‚åº”å‚æ•°ä¼˜åŒ–</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">class<sp/>AdaptiveOptimizer<sp/>{</highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>template&lt;typename<sp/>Func,<sp/>typename...<sp/>Args&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>optimize_parameters(Func&amp;&amp;<sp/>func,<sp/>Args&amp;&amp;...<sp/>args)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>ä½¿ç”¨æœºå™¨å­¦ä¹ ç®—æ³•è‡ªåŠ¨ä¼˜åŒ–å‚æ•°</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>åŸºäºå†å²æ€§èƒ½æ•°æ®è°ƒæ•´è®¡ç®—å‚æ•°</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>bayesian_optimization(std::forward&lt;Func&gt;(func),<sp/>std::forward&lt;Args&gt;(args)...);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">###<sp/>3.<sp/>å¹¶è¡Œè®¡ç®—æ¡†æ¶</highlight></codeline>
<codeline><highlight class="normal">```cpp</highlight></codeline>
<codeline><highlight class="normal">template&lt;typename<sp/>ExecutionPolicy<sp/>=<sp/>std::execution::par_unseq&gt;</highlight></codeline>
<codeline><highlight class="normal">class<sp/>ParallelAnalyzer<sp/>{</highlight></codeline>
<codeline><highlight class="normal">public:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>template&lt;typename<sp/>Container,<sp/>typename<sp/>Func&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>auto<sp/>parallel_transform(const<sp/>Container&amp;<sp/>input,<sp/>Func&amp;&amp;<sp/>func)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::vector&lt;std::invoke_result_t&lt;Func,<sp/>typename<sp/>Container::value_type&gt;&gt;<sp/>output;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output.resize(input.size());</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::transform(ExecutionPolicy{},<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input.begin(),<sp/>input.end(),<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>output.begin(),<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::forward&lt;Func&gt;(func));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>output;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">};</highlight></codeline>
<codeline><highlight class="normal">```</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">##<sp/>ğŸ<sp/>**ç»“è®º**</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">pyfolio_cpp<sp/>é¡¹ç›®å±•ç°å‡ºä¼˜ç§€çš„æ¶æ„è®¾è®¡å’Œç°ä»£<sp/>C++<sp/>å®è·µï¼Œä½†ä»éœ€è¦ç³»ç»Ÿæ€§çš„æ”¹è¿›æ¥è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¦æ±‚ã€‚é€šè¿‡æŒ‰ç…§æœ¬æ–‡æ¡£çš„ä¼˜å…ˆçº§å’Œæ—¶é—´è®¡åˆ’æ‰§è¡Œæ”¹è¿›æªæ–½ï¼Œè¯¥é¡¹ç›®å°†æˆä¸ºä¸€ä¸ªé«˜æ€§èƒ½ã€ç±»å‹å®‰å…¨ã€åŠŸèƒ½å®Œæ•´çš„é‡‘èåˆ†æåº“ã€‚</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">å…³é”®æˆåŠŸå› ç´ :</highlight></codeline>
<codeline><highlight class="normal">1.<sp/>**ä¸¥æ ¼æŒ‰ç…§ä¼˜å…ˆçº§æ‰§è¡Œ**:<sp/>å…ˆè§£å†³åŸºç¡€é—®é¢˜ï¼Œå†ä¼˜åŒ–æ€§èƒ½</highlight></codeline>
<codeline><highlight class="normal">2.<sp/>**æŒç»­é›†æˆ**:<sp/>ç¡®ä¿æ¯ä¸ªæ”¹è¿›éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•</highlight></codeline>
<codeline><highlight class="normal">3.<sp/>**æ€§èƒ½åŸºå‡†**:<sp/>æ¯ä¸ªä¼˜åŒ–éƒ½è¦æœ‰é‡åŒ–çš„æ€§èƒ½æå‡æŒ‡æ ‡</highlight></codeline>
<codeline><highlight class="normal">4.<sp/>**ä»£ç å®¡æŸ¥**:<sp/>ç¡®ä¿ä»£ç è´¨é‡å’Œä¸€è‡´æ€§</highlight></codeline>
<codeline><highlight class="normal">5.<sp/>**æ–‡æ¡£åŒæ­¥**:<sp/>ä»£ç å’Œæ–‡æ¡£åŒæ­¥æ›´æ–°</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">é¢„è®¡å®Œæˆæ‰€æœ‰æ”¹è¿›åï¼Œpyfolio_cpp<sp/>å°†æˆä¸ºä¸šç•Œé¢†å…ˆçš„<sp/>C++<sp/>é‡‘èåˆ†æåº“ï¼Œä¸ºç”¨æˆ·æä¾›å“è¶Šçš„æ€§èƒ½å’Œå¼€å‘ä½“éªŒã€‚</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">---</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">**æ–‡æ¡£ç‰ˆæœ¬**:<sp/>v1.0<sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">**æœ€åæ›´æ–°**:<sp/>2024-06-28<sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">**å®¡æŸ¥è€…**:<sp/>30å¹´ç»éªŒ<sp/>C++/Python<sp/>é«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ<sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">**ä¸‹æ¬¡å®¡æŸ¥**:<sp/>2024-07-28<sp/>(æˆ–ä¸»è¦åŠŸèƒ½å®Œæˆå)</highlight></codeline>
    </programlisting>
    <location file="/Users/yunjinqi/Documents/source_code/pyfolio_cpp/docs/IMPROVEMENT_TODO_LIST.md"/>
  </compounddef>
</doxygen>
